{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/helper/utils.js","webpack:///./src/boot/buildEnv.js","webpack:///./src/core/lifeCycle.js","webpack:///./src/helper/enums.js","webpack:///./src/core/configuration.js","webpack:///./src/core/errorTools.js","webpack:///./src/core/sdk.js","webpack:///./src/helper/tracekit.js","webpack:///./src/core/xhrProxy.js","webpack:///./src/core/observable.js","webpack:///./src/core/downloadProxy.js","webpack:///./src/core/errorCollection.js","webpack:///./src/rumEventsCollection/error/errorCollection.js","webpack:///./src/core/baseInfo.js","webpack:///./src/rumEventsCollection/assembly.js","webpack:///./src/rumEventsCollection/parentContexts.js","webpack:///./src/core/dataMap.js","webpack:///./src/core/transport.js","webpack:///./src/rumEventsCollection/transport/batch.js","webpack:///./src/rumEventsCollection/page/index.js","webpack:///./src/rumEventsCollection/trackEventCounts.js","webpack:///./src/rumEventsCollection/page/viewCollection.js","webpack:///./src/rumEventsCollection/resource/resourceUtils.js","webpack:///./src/rumEventsCollection/requestCollection.js","webpack:///./src/rumEventsCollection/resource/resourceCollection.js","webpack:///./src/rumEventsCollection/app/index.js","webpack:///./src/rumEventsCollection/app/appCollection.js","webpack:///./src/boot/rum.js","webpack:///./src/boot/rum.entry.js","webpack:///./src/rumEventsCollection/performanceCollection.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ArrayProto","Array","ObjProto","slice","toString","nativeForEach","forEach","each","obj","iterator","context","length","values","results","msToNs","duration","toFixed","isString","isNumber","test","String","toArray","iterable","isArray","areInOrder","numbers","arguments","UUID","placeholder","parseInt","Math","random","replace","extend","source","prop","extend2Lev","isObject","now","Date","getTime","throttle","func","wait","options","timeout","args","result","previous","later","leading","apply","throttled","remaining","this","clearTimeout","trailing","setTimeout","cancel","noop","findByPath","path","pathArr","split","shift","withSnakeCaseKeys","candidate","keys","word","uppercaseLetter","index","toLowerCase","deepSnakeCase","map","escapeRowData","str","urlParse","para","URLParser","a","_fields","Username","Password","Port","Protocol","Host","Path","URL","QueryString","Fragment","_values","_regex","_parse","setUrl","_initValues","addQueryString","queryObj","query","RegExp","getParse","getUrl","url","Origin","b","exec","getOwnObjectKeys","isEnumerable","getOwnPropertySymbols","symbols","filter","getOwnPropertyDescriptor","push","defineObject","configurable","writable","sdkVersion","sdkName","LifeCycle","callbacks","eventType","data","eventCallbacks","callback","unsubscribe","other","LifeCycleEventType","RumEventType","RequestType","DEFAULT_CONFIGURATION","sampleRate","flushTimeout","maxErrorsByMinute","maxBatchSize","maxMessageSize","batchBytesLimit","datakitUrl","requestErrorResponseLengthLimit","isIntakeRequest","configuration","url1","url2","parseUrl1","parseUrl2","haveSameOrigin","ErrorSource","toStackTraceString","stack","message","frame","join","line","column","instance","sdk","tracker","wx","request","targetObj","target","getOwnPropertyDescriptors","defineProperties","deepMixObject","err","console","warn","log","getSDK","has","xhrProxySingleton","report","onErrorHandlerInstalled","onUnhandledRejectionHandlerInstalled","onPageNotFoundHandlerInstalled","onOnMemoryWarningHandlerInstalled","handlers","notifyHandlers","isWindowError","error","exception","inner","traceKitWindowOnError","Error","msg","computeStackTrace","messages","groups","match","ERROR_TYPES_RE","traceKitWindowOnUnhandledRejection","reason","promise","doReport","ex","subscribe","handler","onError","installGlobalHandler","onUnhandledRejection","installGlobalUnhandledRejectionHandler","onPageNotFound","res","JSON","stringify","type","installGlobalOnPageNotFoundHandler","onMemoryWarning","level","levelMessage","installGlobalOnMemoryWarningHandler","splice","computeStackTraceFromStackProp","isEval","submatch","parts","element","chrome","gecko","winjs","geckoEval","chromeEval","lines","j","isNative","indexOf","undefined","columnNumber","extractMessage","augmentStackTraceWithInitialElement","stackInfo","lineNo","initial","incompvare","unshift","partial","computeStackTraceByWalkingCallerChain","depth","item","functionName","funcs","recursion","curr","caller","input","substring","sourceURL","fileName","lineNumber","description","doComputeStackTrace","normalizedDepth","stacktrace","opera10Regex","opera11Regex","computeStackTraceFromStacktraceProp","e","lineRE1","lineRE2","lineRE3","scripts","window","document","getElementsByTagName","inlineScriptBlocks","src","location","href","computeStackTraceFromOperaMultiLineMessage","ofCaller","currentDepth","Observable","observers","f","observer","originalXhrRequest","downloadProxySingleton","beforeSendCallbacks","onRequestCompleteCallbacks","startXhrProxy","dataflux_xhr","method","startTime","responseType","originalSuccess","success","reportXhr","_this","originalFail","fail","hasBeenReported","response","header","profile","status","statusCode","beforeSend","onRequestComplete","originalDownloadRequest","originalConsoleError","traceKitReportHandler","filteredErrorsObservable","startDownloadProxy","downloadFile","filePath","tempFilePath","formatConsoleParameters","param","startRuntimeErrorTracking","errorObservable","stackTrace","_","errorObject","nonErrorPrefix","formatUnknownError","notify","startAutomaticErrorCollection","handleCompleteRequest","isRejected","isServerError","format","resource","truncateResponse","trackNetworkError","concat","startConsoleTracking","errorCount","filteredErrorObservable","setInterval","filterErrors","startErrorCollection","lifeCycle","observable","rawRumEvent","date","starttime","processError","doStartErrorCollection","sessionId","getDeviceInfo","getNetWork","deviceInfo","getSystemInfoSync","osInfo","system","screenSize","screenWidth","screenHeight","platform","platformVersion","version","osVersion","os","brand","model","frameworkVersion","SDKVersion","pixelRatio","clienetId","getStorageSync","setStorageSync","getNetworkType","network","networkType","onNetworkStatusChange","isTracked","threshold","startParentContexts","currentView","previousViews","currentContext","buildCurrentViewContext","endTime","id","clearOldContextsInterval","previousContexts","timeOutDelay","oldTimeThreshold","pop","clearOldContexts","page","referrer","route","parentContexts","findView","buildContext","flag","previousContext","findContext","findViewV2","viewContext","stop","clearInterval","rum_mini_app_startup","tags","app_id","env","app_version","sdk_name","sdk_version","is_signin","device","screen_size","network_type","platform_version","app_framework_version","app_startup_type","fields","app_script_load_duration","app_code_download_duration","app_startup_duration","rum_mini_app_page_performance","page_apdex_level","page_fmp","page_fpt","page_resource_load_time","page_onload2onshow","page_onshow2onready","page_staytime","page_js_error_count","rum_mini_app_resource_performance","resource_status_group","resource_url_host","resource_type","resource_status","resource_method","response_connection","response_server","response_content_type","response_content_encoding","resource_size","resource_load","resource_dns","resource_tcp","resource_ssl","resource_ttfb","resource_trans","resource_firstbyte","os_version","origin_id","userid","page_id","page_url","page_referer","resource_url","resource_url_path","request_header","response_header","js_error","error_type","error_starttime","error_message","error_stack","HAS_MULTI_BYTES_CHARACTERS","httpRequest","endpointUrl","bytesLimit","send","addBatchPrecision","HttpRequest","maxSize","flushOnVisibilityHidden","flushPeriodically","pushOnlyBuffer","upsertBuffer","bufferBytesSize","bufferMessageCount","add","addOrUpdate","upsert","flush","processSendData","rowsStr","dataMap","rowStr","tagsStr","value_path","_key","_value","fieldsStr","_valueData","sizeInBytes","Blob","size","process","processedMessage","messageBytesSize","hasMessageFor","remove","willReachedBytesLimitWith","isFull","removedMessage","Batch","startRumBatch","batch","primaryBatch","createRumBatch","stopped","makeRumBatch","rumEvent","serverRumEvent","rewritePage","originPage","Page","methodName","userDefinedMethod","activePage","curPages","getCurrentPages","getActivePage","loadingTime","showTime","onload2onshowTime","onshow2onready","stayTime","fpt","fmp","eventCounts","resourceCount","documentVersion","scheduleViewUpdate","triggerViewUpdate","cancelScheduleViewUpdate","stopEventCountsTracking","subscription","trackEventCounts","newEventCounts","stopFptTracking","entitys","firstRenderEntity","find","entity","entryType","trackFptTime","scheduleUpdate","setLoadEventEnd","triggerUpdate","end","newView","startViewCollection","view","apdexLevel","Number","_dd","count","onload2onshow","timeSpent","processViewUpdate","computePerformanceResourceDuration","entry","responseEnd","computePerformanceResourceDetails","validEntry","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","hasRedirection","redirectStart","redirectEnd","toValidEntry","SSLconnectionStart","SSLconnectionEnd","details","firstbyte","formatTiming","trans","ttfb","tcp","secureConnectionStart","ssl","dns","redirect","origin","start","computeSize","receivedBytedCount","isAllowedRequestUrl","nextRequestIndex","startRequestCollection","xhrProxy","requestIndex","getNextRequestIndex","parseHeader","performance","responseConnection","responseServer","responseHeader","getHeaderString","responseContentType","responseContentEncoding","trackXhr","dwonloadProxy","trackDownload","headerStr","startResourceCollection","timing","correspondingTimingOverrides","load","computePerformanceEntryMetricsV2","urlObj","resourceEvent","statusGroup","getStatusGroup","urlHost","urlPath","processRequest","substr","startupTypes","rewriteApp","originApp","App","appInfo","isStartUp","app","isHide","startupType","scheduleAppUpdate","startupDuration","scriptLoadDuration","codeDownloadDuration","launchEntity","navigationType","scriptentity","firstEntity","startPerformanceObservable","startAppCollection","appinfo","processAppUpdate","datafluxRum","startRumImpl","userConfiguration","buildEnv","transportConfiguration","applicationId","datakitOrigin","lastIndexOf","commonInit","deviceContext","baseInfo","rumContext","application","user","originId","getSessionId","user_id","getClientID","startRumAssembly","getPerformance","createObserver","entryList","getEntries","observe","entryTypes","startPagePerformanceObservable","isAlreadyInitialized","init","canInitRum"],"mappings":"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","file":"dataflux-rum-miniapp.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","var ArrayProto = Array.prototype\nvar ObjProto = Object.prototype\nvar ObjProto = Object.prototype\nvar hasOwnProperty = ObjProto.hasOwnProperty\nvar slice = ArrayProto.slice\nvar toString = ObjProto.toString\nvar nativeForEach = ArrayProto.forEach\nvar breaker = false\nexport var isArguments = function (obj) {\n\treturn !!(obj && hasOwnProperty.call(obj, 'callee'))\n}\nexport var each = function (obj, iterator, context) {\n\tif (obj === null) return false\n\tif (nativeForEach && obj.forEach === nativeForEach) {\n\t\tobj.forEach(iterator, context)\n\t} else if (obj.length === +obj.length) {\n\t\tfor (var i = 0, l = obj.length; i < l; i++) {\n\t\t\tif (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\tif (iterator.call(context, obj[key], key, obj) === breaker) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nexport var values = function (obj) {\n\tvar results = []\n\tif (obj === null) {\n\t\treturn results\n\t}\n\teach(obj, function (value) {\n\t\tresults[results.length] = value\n\t})\n\treturn results\n}\nexport function round(num, decimals) {\n\treturn +num.toFixed(decimals)\n}\n\nexport function msToNs(duration) {\n\tif (typeof duration !== 'number') {\n\t\treturn duration\n\t}\n\treturn round(duration * 1e6, 0)\n}\nexport var isUndefined = function (obj) {\n\treturn obj === void 0\n}\nexport var isString = function (obj) {\n\treturn toString.call(obj) === '[object String]'\n}\nexport var isDate = function (obj) {\n\treturn toString.call(obj) === '[object Date]'\n}\nexport var isBoolean = function (obj) {\n\treturn toString.call(obj) === '[object Boolean]'\n}\nexport var isNumber = function (obj) {\n\treturn toString.call(obj) === '[object Number]' && /[\\d\\.]+/.test(String(obj))\n}\n\nexport var toArray = function (iterable) {\n\tif (!iterable) return []\n\tif (iterable.toArray) {\n\t\treturn iterable.toArray()\n\t}\n\tif (Array.isArray(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\tif (isArguments(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\treturn values(iterable)\n}\nexport var areInOrder = function () {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\nexport function UUID(placeholder) {\n\treturn placeholder\n\t\t? // tslint:disable-next-line no-bitwise\n\t\t  (\n\t\t\t\tparseInt(placeholder, 10) ^\n\t\t\t\t((Math.random() * 16) >> (parseInt(placeholder, 10) / 4))\n\t\t  ).toString(16)\n\t\t: `${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g, UUID)\n}\n\nexport function isPercentage(value) {\n\treturn isNumber(value) && value >= 0 && value <= 100\n}\n\nexport var extend = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tobj[prop] = source[prop]\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\nexport var extend2Lev = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tif (isObject(source[prop]) && isObject(obj[prop])) {\n\t\t\t\t\textend(obj[prop], source[prop])\n\t\t\t\t} else {\n\t\t\t\t\tobj[prop] = source[prop]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\n\nexport var trim = function (str) {\n\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\nexport var isObject = function (obj) {\n\tif (obj === null) return false\n\treturn toString.call(obj) === '[object Object]'\n}\nexport var isEmptyObject = function (obj) {\n\tif (isObject(obj)) {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t} else {\n\t\treturn false\n\t}\n}\n\nexport var isJSONString = function (str) {\n\ttry {\n\t\tJSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn true\n}\nexport var safeJSONParse = function (str) {\n\tvar val = null\n\ttry {\n\t\tval = JSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn val\n}\nexport var now =\n\tDate.now ||\n\tfunction () {\n\t\treturn new Date().getTime()\n\t}\nexport var throttle = function (func, wait, options) {\n\tvar timeout, context, args, result\n\tvar previous = 0\n\tif (!options) options = {}\n\n\tvar later = function () {\n\t\tprevious = options.leading === false ? 0 : new Date().getTime()\n\t\ttimeout = null\n\t\tresult = func.apply(context, args)\n\t\tif (!timeout) context = args = null\n\t}\n\n\tvar throttled = function () {\n\t\targs = arguments\n\t\tvar now = new Date().getTime()\n\t\tif (!previous && options.leading === false) previous = now\n\t\t//下次触发 func 剩余的时间\n\t\tvar remaining = wait - (now - previous)\n\t\tcontext = this\n\t\t// 如果没有剩余的时间了或者你改了系统时间\n\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout)\n\t\t\t\ttimeout = null\n\t\t\t}\n\t\t\tprevious = now\n\t\t\tresult = func.apply(context, args)\n\t\t\tif (!timeout) context = args = null\n\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\ttimeout = setTimeout(later, remaining)\n\t\t}\n\t\treturn result\n\t}\n\tthrottled.cancel = function () {\n\t\tclearTimeout(timeout)\n\t\tprevious = 0\n\t\ttimeout = null\n\t}\n\treturn throttled\n}\nexport function noop() {}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\nexport function performDraw(threshold) {\n\treturn threshold !== 0 && Math.random() * 100 <= threshold\n}\nexport function findByPath(source, path) {\n\tvar pathArr = path.split('.')\n\twhile (pathArr.length) {\n\t\tvar key = pathArr.shift()\n\t\tif (key in source && hasOwnProperty.call(source, key)) {\n\t\t\tsource = source[key]\n\t\t} else {\n\t\t\treturn undefined\n\t\t}\n\t}\n\treturn source\n}\nexport function withSnakeCaseKeys(candidate) {\n\tconst result = {}\n\tObject.keys(candidate).forEach((key) => {\n\t\tresult[toSnakeCase(key)] = deepSnakeCase(candidate[key])\n\t})\n\treturn result\n}\n\nexport function deepSnakeCase(candidate) {\n\tif (Array.isArray(candidate)) {\n\t\treturn candidate.map((value) => deepSnakeCase(value))\n\t}\n\tif (typeof candidate === 'object' && candidate !== null) {\n\t\treturn withSnakeCaseKeys(candidate)\n\t}\n\treturn candidate\n}\n\nexport function toSnakeCase(word) {\n\treturn word\n\t\t.replace(\n\t\t\t/[A-Z]/g,\n\t\t\t(uppercaseLetter, index) =>\n\t\t\t\t`${index !== 0 ? '_' : ''}${uppercaseLetter.toLowerCase()}`,\n\t\t)\n\t\t.replace(/-/g, '_')\n}\n\nexport function escapeRowData(str) {\n\tif (!isString(str)) return str\n\tvar reg = /[\\s=,\"]/g\n\treturn String(str).replace(reg, function (word) {\n\t\treturn '\\\\' + word\n\t})\n}\nexport var urlParse = function (para) {\n\tvar URLParser = function (a) {\n\t\tthis._fields = {\n\t\t\tUsername: 4,\n\t\t\tPassword: 5,\n\t\t\tPort: 7,\n\t\t\tProtocol: 2,\n\t\t\tHost: 6,\n\t\t\tPath: 8,\n\t\t\tURL: 0,\n\t\t\tQueryString: 9,\n\t\t\tFragment: 10,\n\t\t}\n\t\tthis._values = {}\n\t\tthis._regex = null\n\t\tthis._regex = /^((\\w+):\\/\\/)?((\\w+):?(\\w+)?@)?([^\\/\\?:]+):?(\\d+)?(\\/?[^\\?#]+)?\\??([^#]+)?#?(\\w*)/\n\n\t\tif (typeof a != 'undefined') {\n\t\t\tthis._parse(a)\n\t\t}\n\t}\n\tURLParser.prototype.setUrl = function (a) {\n\t\tthis._parse(a)\n\t}\n\tURLParser.prototype._initValues = function () {\n\t\tfor (var a in this._fields) {\n\t\t\tthis._values[a] = ''\n\t\t}\n\t}\n\tURLParser.prototype.addQueryString = function (queryObj) {\n\t\tif (typeof queryObj !== 'object') {\n\t\t\treturn false\n\t\t}\n\t\tvar query = this._values.QueryString || ''\n\t\tfor (var i in queryObj) {\n\t\t\tif (new RegExp(i + '[^&]+').test(query)) {\n\t\t\t\tquery = query.replace(new RegExp(i + '[^&]+'), i + '=' + queryObj[i])\n\t\t\t} else {\n\t\t\t\tif (query.slice(-1) === '&') {\n\t\t\t\t\tquery = query + i + '=' + queryObj[i]\n\t\t\t\t} else {\n\t\t\t\t\tif (query === '') {\n\t\t\t\t\t\tquery = i + '=' + queryObj[i]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquery = query + '&' + i + '=' + queryObj[i]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._values.QueryString = query\n\t}\n\tURLParser.prototype.getParse = function () {\n\t\treturn this._values\n\t}\n\tURLParser.prototype.getUrl = function () {\n\t\tvar url = ''\n\t\turl += this._values.Origin\n\t\turl += this._values.Port ? ':' + this._values.Port : ''\n\t\turl += this._values.Path\n\t\turl += this._values.QueryString ? '?' + this._values.QueryString : ''\n\t\treturn url\n\t}\n\tURLParser.prototype._parse = function (a) {\n\t\tthis._initValues()\n\t\tvar b = this._regex.exec(a)\n\t\tif (!b) {\n\t\t\tthrow 'DPURLParser::_parse -> Invalid URL'\n\t\t}\n\t\tfor (var c in this._fields) {\n\t\t\tif (typeof b[this._fields[c]] != 'undefined') {\n\t\t\t\tthis._values[c] = b[this._fields[c]]\n\t\t\t}\n\t\t}\n\t\tthis._values['Hostname'] = this._values['Host'].replace(/:\\d+$/, '')\n\t\tthis._values['Origin'] =\n\t\t\tthis._values['Protocol'] + '://' + this._values['Hostname']\n\t}\n\treturn new URLParser(para)\n}\nexport const getOwnObjectKeys = function (obj, isEnumerable) {\n\tvar keys = Object.keys(obj)\n\tif (Object.getOwnPropertySymbols) {\n\t\tvar symbols = Object.getOwnPropertySymbols(obj)\n\t\tif (isEnumerable) {\n\t\t\tsymbols = symbols.filter(function (t) {\n\t\t\t\treturn Object.getOwnPropertyDescriptor(obj, t).enumerable\n\t\t\t})\n\t\t}\n\t\tkeys.push.apply(keys, symbols)\n\t}\n\treturn keys\n}\nexport const defineObject = function (obj, key, value) {\n\tif (key in obj) {\n\t\tObject.defineProperty(obj, key, {\n\t\t\tvalue,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\t\t})\n\t} else {\n\t\tobj[key] = value\n\t}\n\treturn obj\n}\nexport const deepMixObject = function (targetObj) {\n\tfor (var t = 1; t < arguments.length; t++) {\n\t\tvar target = arguments[t] != null ? arguments[t] : {}\n\t\tif (t % 2) {\n\t\t\tgetOwnObjectKeys(Object(target), true).forEach(function (t) {\n\t\t\t\tdefineObject(targetObj, t, target[t])\n\t\t\t})\n\t\t} else {\n\t\t\tif (Object.getOwnPropertyDescriptors) {\n\t\t\t\tObject.defineProperties(\n\t\t\t\t\ttargetObj,\n\t\t\t\t\tObject.getOwnPropertyDescriptors(target),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tgetOwnObjectKeys(Object(target)).forEach(function (t) {\n\t\t\t\t\tObject.defineProperty(\n\t\t\t\t\t\ttargetObj,\n\t\t\t\t\t\tt,\n\t\t\t\t\t\tObject.getOwnPropertyDescriptor(target, t),\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\treturn targetObj\n}\n","export const buildEnv = {\n\tsdkVersion: '<<< SDK_VERSION >>>',\n\tsdkName: 'Web SDK',\n}\n","export class LifeCycle {\n\tconstructor() {\n\t\tthis.callbacks = {}\n\t}\n\tnotify(eventType, data) {\n\t\tconst eventCallbacks = this.callbacks[eventType]\n\t\tif (eventCallbacks) {\n\t\t\teventCallbacks.forEach((callback) => callback(data))\n\t\t}\n\t}\n\tsubscribe(eventType, callback) {\n\t\tif (!this.callbacks[eventType]) {\n\t\t\tthis.callbacks[eventType] = []\n\t\t}\n\t\tthis.callbacks[eventType].push(callback)\n\t\treturn {\n\t\t\tunsubscribe: () => {\n\t\t\t\tthis.callbacks[eventType] = this.callbacks[eventType].filter(\n\t\t\t\t\t(other) => callback !== other,\n\t\t\t\t)\n\t\t\t},\n\t\t}\n\t}\n}\n\nexport var LifeCycleEventType = {\n\tPERFORMANCE_ENTRY_COLLECTED: 'PERFORMANCE_ENTRY_COLLECTED',\n\tAPP_HIDE: 'APP_HIDE',\n\tAPP_UPDATE: 'APP_UPDATE',\n\tVIEW_CREATED: 'VIEW_CREATED',\n\tVIEW_UPDATED: 'VIEW_UPDATED',\n\tREQUEST_STARTED: 'REQUEST_STARTED',\n\tREQUEST_COMPLETED: 'REQUEST_COMPLETED',\n\tRAW_RUM_EVENT_COLLECTED: 'RAW_RUM_EVENT_COLLECTED',\n\tRUM_EVENT_COLLECTED: 'RUM_EVENT_COLLECTED',\n}\n","export const ONE_SECOND = 1000\nexport const ONE_MINUTE = 60 * ONE_SECOND\nexport const ONE_HOUR = 60 * ONE_MINUTE\nexport const ONE_KILO_BYTE = 1024\nexport const CLIENT_ID_TOKEN = 'datafluxRum:client:id'\nexport const RumEventType = {\n\tACTION: 'action',\n\tERROR: 'error',\n\tLONG_TASK: 'long_task',\n\tVIEW: 'view',\n\tRESOURCE: 'resource',\n\tAPP: 'app',\n}\n\nexport var RequestType = {\n\tXHR: 'network',\n\tDOWNLOAD: 'resource',\n}\n","import { extend2Lev, urlParse } from '../helper/utils'\nimport { ONE_KILO_BYTE, ONE_SECOND } from '../helper/enums'\nexport var DEFAULT_CONFIGURATION = {\n\tsampleRate: 100,\n\tflushTimeout: 30 * ONE_SECOND,\n\tmaxErrorsByMinute: 3000,\n\t/**\n\t * Logs intake limit\n\t */\n\tmaxBatchSize: 50,\n\tmaxMessageSize: 256 * ONE_KILO_BYTE,\n\n\t/**\n\t * beacon payload max queue size implementation is 64kb\n\t * ensure that we leave room for logs, rum and potential other users\n\t */\n\tbatchBytesLimit: 16 * ONE_KILO_BYTE,\n\tdatakitUrl: '',\n\t/**\n\t * arbitrary value, byte precision not needed\n\t */\n\trequestErrorResponseLengthLimit: 32 * ONE_KILO_BYTE,\n}\n\nfunction getDatakitUrlUrl(url) {\n\tif (url.lastIndexOf('/') === url.length - 1) return url + 'v1/write/rum'\n\treturn url + '/v1/write/rum'\n}\nexport function commonInit(userConfiguration, buildEnv) {\n\tvar transportConfiguration = {\n\t\tapplicationId: userConfiguration.applicationId,\n\t\tenv: userConfiguration.env || '',\n\t\tversion: userConfiguration.version || '',\n\t\tsdkVersion: buildEnv.sdkVersion,\n\t\tsdkName: buildEnv.sdkName,\n\t\tdatakitUrl: getDatakitUrlUrl(\n\t\t\tuserConfiguration.datakitUrl || userConfiguration.datakitOrigin,\n\t\t),\n\t\ttags: userConfiguration.tags || [],\n\t}\n\treturn extend2Lev(DEFAULT_CONFIGURATION, transportConfiguration)\n}\nconst haveSameOrigin = function (url1, url2) {\n\tconst parseUrl1 = urlParse(url1).getParse()\n\tconst parseUrl2 = urlParse(url2).getParse()\n\treturn parseUrl1.Origin === parseUrl2.Origin\n}\nexport function isIntakeRequest(url, configuration) {\n\treturn haveSameOrigin(url, configuration.datakitUrl)\n}\n","export var ErrorSource = {\n\tAGENT: 'agent',\n\tCONSOLE: 'console',\n\tNETWORK: 'network',\n\tSOURCE: 'source',\n\tLOGGER: 'logger',\n}\nexport function formatUnknownError(stackTrace, errorObject, nonErrorPrefix) {\n\tif (\n\t\t!stackTrace ||\n\t\t(stackTrace.message === undefined && !(errorObject instanceof Error))\n\t) {\n\t\treturn {\n\t\t\tmessage: nonErrorPrefix + '' + JSON.stringify(errorObject),\n\t\t\tstack: 'No stack, consider using an instance of Error',\n\t\t\ttype: stackTrace && stackTrace.name,\n\t\t}\n\t}\n\treturn {\n\t\tmessage: stackTrace.message || 'Empty message',\n\t\tstack: toStackTraceString(stackTrace),\n\t\ttype: stackTrace.name,\n\t}\n}\n\nexport function toStackTraceString(stack) {\n\tvar result = stack.name || 'Error' + ': ' + stack.message\n\tstack.stack.forEach(function (frame) {\n\t\tvar func = frame.func === '?' ? '<anonymous>' : frame.func\n\t\tvar args =\n\t\t\tframe.args && frame.args.length > 0\n\t\t\t\t? '(' + frame.args.join(', ') + ')'\n\t\t\t\t: ''\n\t\tvar line = frame.line ? ':' + frame.line : ''\n\t\tvar column = frame.line && frame.column ? ':' + frame.column : ''\n\t\tresult += '\\n  at ' + func + args + ' @ ' + frame.url + line + column\n\t})\n\treturn result\n}\n","import { deepMixObject } from '../helper/utils'\n\nfunction getSDK() {\n\tvar sdk = null,\n\t\ttracker = ''\n\ttry {\n\t\tif (wx && typeof wx === 'object' && typeof wx.request === 'function') {\n\t\t\tsdk = deepMixObject({}, wx)\n\t\t\ttracker = 'wx'\n\t\t\twx = sdk\n\t\t}\n\t} catch (err) {\n\t\tconsole.warn('unsupport platform, Fail to start')\n\t}\n\tconsole.log('------get SDK-------')\n\treturn { sdk, tracker }\n}\nconst instance = getSDK()\n\nexport const sdk = instance.sdk\nexport const tracker = instance.tracker\n","import { sdk } from '../core/sdk'\n\nconst UNKNOWN_FUNCTION = '?'\nfunction has(object, key) {\n\treturn Object.prototype.hasOwnProperty.call(object, key)\n}\nfunction isUndefined(what) {\n\treturn typeof what === 'undefined'\n}\nexport function wrap(func) {\n\tvar _this = this\n\tfunction wrapped() {\n\t\ttry {\n\t\t\treturn func.apply(_this, arguments)\n\t\t} catch (e) {\n\t\t\treport(e)\n\t\t\tthrow e\n\t\t}\n\t}\n\treturn wrapped\n}\n/**\n * Cross-browser processing of unhandled exceptions\n *\n * Syntax:\n * ```js\n *   report.subscribe(function(stackInfo) { ... })\n *   report.unsubscribe(function(stackInfo) { ... })\n *   report(exception)\n *   try { ...code... } catch(ex) { report(ex); }\n * ```\n *\n * Supports:\n *   - Firefox: full stack trace with line numbers, plus column number\n *     on top frame; column number is not guaranteed\n *   - Opera: full stack trace with line and column numbers\n *   - Chrome: full stack trace with line and column numbers\n *   - Safari: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *   - IE: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *\n * In theory, TraceKit should work on all of the following versions:\n *   - IE5.5+ (only 8.0 tested)\n *   - Firefox 0.9+ (only 3.5+ tested)\n *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\n *     Exceptions Have Stacktrace to be enabled in opera:config)\n *   - Safari 3+ (only 4+ tested)\n *   - Chrome 1+ (only 5+ tested)\n *   - Konqueror 3.5+ (untested)\n *\n * Requires computeStackTrace.\n *\n * Tries to catch all unhandled exceptions and report them to the\n * subscribed handlers. Please note that report will rethrow the\n * exception. This is REQUIRED in order to get a useful stack trace in IE.\n * If the exception does not reach the top of the browser, you will only\n * get a stack trace from the point where report was called.\n *\n * Handlers receive a StackTrace object as described in the\n * computeStackTrace docs.\n *\n * @memberof TraceKit\n * @namespace\n */\nexport var report = (function reportModuleWrapper() {\n\tvar handlers = []\n\n\t/**\n\t * Add a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction subscribe(handler) {\n\t\tinstallGlobalHandler()\n\t\tinstallGlobalUnhandledRejectionHandler()\n\t\tinstallGlobalOnPageNotFoundHandler()\n\t\tinstallGlobalOnMemoryWarningHandler()\n\t\thandlers.push(handler)\n\t}\n\n\t/**\n\t * Remove a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction unsubscribe(handler) {\n\t\tfor (var i = handlers.length - 1; i >= 0; i -= 1) {\n\t\t\tif (handlers[i] === handler) {\n\t\t\t\thandlers.splice(i, 1)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Dispatch stack information to all handlers.\n\t * @param {StackTrace} stack\n\t * @param {boolean} isWindowError Is this a top-level window error?\n\t * @param {Error=} error The error that's being handled (if available, null otherwise)\n\t * @memberof report\n\t * @throws An exception if an error occurs while calling an handler.\n\t */\n\tfunction notifyHandlers(stack, isWindowError, error) {\n\t\tvar exception\n\t\tfor (var i in handlers) {\n\t\t\tif (has(handlers, i)) {\n\t\t\t\ttry {\n\t\t\t\t\thandlers[i](stack, isWindowError, error)\n\t\t\t\t} catch (inner) {\n\t\t\t\t\texception = inner\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (exception) {\n\t\t\tthrow exception\n\t\t}\n\t}\n\n\tvar onErrorHandlerInstalled\n\tvar onUnhandledRejectionHandlerInstalled\n\tvar onPageNotFoundHandlerInstalled\n\tvar onOnMemoryWarningHandlerInstalled\n\t/**\n\t * Ensures all global unhandled exceptions are recorded.\n\t * Supported by Gecko and IE.\n\t * @param {Event|string} message Error message.\n\t * @param {string=} url URL of script that generated the exception.\n\t * @param {(number|string)=} lineNo The line number at which the error occurred.\n\t * @param {(number|string)=} columnNo The column number at which the error occurred.\n\t * @param {Error=} errorObj The actual Error object.\n\t * @memberof report\n\t */\n\tfunction traceKitWindowOnError(err) {\n\t\tconst error = typeof err === 'string' ? new Error(err) : err\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Ensures all unhandled rejections are recorded.\n\t * @param {PromiseRejectionEvent} e event.\n\t * @memberof report\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunhandledrejection\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n\t */\n\tfunction traceKitWindowOnUnhandledRejection({ reason, promise }) {\n\t\tconst error = typeof reason === 'string' ? new Error(reason) : reason\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Install a global onerror handler\n\t * @memberof report\n\t */\n\tfunction installGlobalHandler() {\n\t\tif (onErrorHandlerInstalled || !sdk.onError) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onError(traceKitWindowOnError)\n\t\tonErrorHandlerInstalled = true\n\t}\n\n\t/**\n\t * Install a global onunhandledrejection handler\n\t * @memberof report\n\t */\n\tfunction installGlobalUnhandledRejectionHandler() {\n\t\tif (onUnhandledRejectionHandlerInstalled || !sdk.onUnhandledRejection) {\n\t\t\treturn\n\t\t}\n\n\t\tsdk.onUnhandledRejection &&\n\t\t\tsdk.onUnhandledRejection(traceKitWindowOnUnhandledRejection)\n\t\tonUnhandledRejectionHandlerInstalled = true\n\t}\n\tfunction installGlobalOnPageNotFoundHandler() {\n\t\tif (onPageNotFoundHandlerInstalled || !sdk.onPageNotFound) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onPageNotFound((res) => {\n\t\t\tconst url = res.path.split('?')[0]\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: JSON.stringify(res),\n\t\t\t\t\ttype: 'pagenotfound',\n\t\t\t\t\tname: url + '页面无法找到',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonPageNotFoundHandlerInstalled = true\n\t}\n\tfunction installGlobalOnMemoryWarningHandler() {\n\t\tif (onOnMemoryWarningHandlerInstalled || !sdk.onMemoryWarning) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onMemoryWarning(({ level = -1 }) => {\n\t\t\tlet levelMessage = '没有获取到告警级别信息'\n\n\t\t\tswitch (level) {\n\t\t\t\tcase 5:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_MODERATE'\n\t\t\t\t\tbreak\n\t\t\t\tcase 10:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_LOW'\n\t\t\t\t\tbreak\n\t\t\t\tcase 15:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_CRITICAL'\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\treturn\n\t\t\t}\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: levelMessage,\n\t\t\t\t\ttype: 'memorywarning',\n\t\t\t\t\tname: '内存不足告警',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonOnMemoryWarningHandlerInstalled = true\n\t}\n\t/**\n\t * Reports an unhandled Error.\n\t * @param {Error} ex\n\t * @memberof report\n\t * @throws An exception if an incompvare stack trace is detected (old IE browsers).\n\t */\n\tfunction doReport(ex) {}\n\n\tdoReport.subscribe = subscribe\n\tdoReport.unsubscribe = unsubscribe\n\tdoReport.traceKitWindowOnError = traceKitWindowOnError\n\n\treturn doReport\n})()\n\n/**\n * computeStackTrace: cross-browser stack traces in JavaScript\n *\n * Syntax:\n *   ```js\n *   s = computeStackTrace.ofCaller([depth])\n *   s = computeStackTrace(exception) // consider using report instead (see below)\n *   ```\n *\n * Supports:\n *   - Firefox:  full stack trace with line numbers and unreliable column\n *               number on top frame\n *   - Opera 10: full stack trace with line and column numbers\n *   - Opera 9-: full stack trace with line numbers\n *   - Chrome:   full stack trace with line and column numbers\n *   - Safari:   line and column number for the topmost stacktrace element\n *               only\n *   - IE:       no line numbers whatsoever\n *\n * Tries to guess names of anonymous functions by looking for assignments\n * in the source code. In IE and Safari, we have to guess source file names\n * by searching for function bodies inside all page scripts. This will not\n * work for scripts that are loaded cross-domain.\n * Here be dragons: some function names may be guessed incorrectly, and\n * duplicate functions may be mismatched.\n *\n * computeStackTrace should only be used for tracing purposes.\n * Logging of unhandled exceptions should be done with report,\n * which builds on top of computeStackTrace and provides better\n * IE support by utilizing the sdk.onError event to retrieve information\n * about the top of the stack.\n *\n * Note: In IE and Safari, no stack trace is recorded on the Error object,\n * so computeStackTrace instead walks its *own* chain of callers.\n * This means that:\n *  * in Safari, some methods may be missing from the stack trace;\n *  * in IE, the topmost function in the stack trace will always be the\n *    caller of computeStackTrace.\n *\n * This is okay for tracing (because you are likely to be calling\n * computeStackTrace from the function you want to be the topmost element\n * of the stack trace anyway), but not okay for logging unhandled\n * exceptions (because your catch block will likely be far away from the\n * inner function that actually caused the exception).\n *\n * Tracing example:\n *  ```js\n *     function trace(message) {\n *         var stackInfo = computeStackTrace.ofCaller();\n *         var data = message + \"\\n\";\n *         for(var i in stackInfo.stack) {\n *             var item = stackInfo.stack[i];\n *             data += (item.func || '[anonymous]') + \"() in \" + item.url + \":\" + (item.line || '0') + \"\\n\";\n *         }\n *         if (window.console)\n *             console.info(data);\n *         else\n *             alert(data);\n *     }\n * ```\n * @memberof TraceKit\n * @namespace\n */\nexport var computeStackTrace = (function computeStackTraceWrapper() {\n\tvar debug = false\n\n\t// Contents of Exception in various browsers.\n\t//\n\t// SAFARI:\n\t// ex.message = Can't find variable: qq\n\t// ex.line = 59\n\t// ex.sourceId = 580238192\n\t// ex.sourceURL = http://...\n\t// ex.expressionBeginOffset = 96\n\t// ex.expressionCaretOffset = 98\n\t// ex.expressionEndOffset = 98\n\t// ex.name = ReferenceError\n\t//\n\t// FIREFOX:\n\t// ex.message = qq is not defined\n\t// ex.fileName = http://...\n\t// ex.lineNumber = 59\n\t// ex.columnNumber = 69\n\t// ex.stack = ...stack trace... (see the example below)\n\t// ex.name = ReferenceError\n\t//\n\t// CHROME:\n\t// ex.message = qq is not defined\n\t// ex.name = ReferenceError\n\t// ex.type = not_defined\n\t// ex.arguments = ['aa']\n\t// ex.stack = ...stack trace...\n\t//\n\t// INTERNET EXPLORER:\n\t// ex.message = ...\n\t// ex.name = ReferenceError\n\t//\n\t// OPERA:\n\t// ex.message = ...message... (see the example below)\n\t// ex.name = ReferenceError\n\t// ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)\n\t// ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'\n\n\t/**\n\t * Computes stack trace information from the stack property.\n\t * Chrome and Gecko use this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStackProp(ex) {\n\t\tif (!ex.stack) {\n\t\t\treturn\n\t\t}\n\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\\[native).*?|[^@]*bundle)(?::(\\d+))?(?::(\\d+))?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i\n\n\t\t// Used to additionally parse URL/line/column from eval frames\n\t\tvar isEval\n\t\tvar geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i\n\t\tvar chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/\n\t\tvar lines = ex.stack.split('\\n')\n\t\tvar stack = []\n\t\tvar submatch\n\t\tvar parts\n\t\tvar element\n\n\t\tfor (var i = 0, j = lines.length; i < j; i += 1) {\n\t\t\tif (chrome.exec(lines[i])) {\n\t\t\t\tparts = chrome.exec(lines[i])\n\t\t\t\tvar isNative = parts[2] && parts[2].indexOf('native') === 0 // start of line\n\t\t\t\tisEval = parts[2] && parts[2].indexOf('eval') === 0 // start of line\n\t\t\t\tsubmatch = chromeEval.exec(parts[2])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line/column number\n\t\t\t\t\tparts[2] = submatch[1] // url\n\t\t\t\t\tparts[3] = submatch[2] // line\n\t\t\t\t\tparts[4] = submatch[3] // column\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: isNative ? [parts[2]] : [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[3] ? +parts[3] : undefined,\n\t\t\t\t\turl: !isNative ? parts[2] : undefined,\n\t\t\t\t}\n\t\t\t} else if (winjs.exec(lines[i])) {\n\t\t\t\tparts = winjs.exec(lines[i])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: +parts[3],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (gecko.exec(lines[i])) {\n\t\t\t\tparts = gecko.exec(lines[i])\n\t\t\t\tisEval = parts[3] && parts[3].indexOf(' > eval') > -1\n\t\t\t\tsubmatch = geckoEval.exec(parts[3])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line number\n\t\t\t\t\tparts[3] = submatch[1]\n\t\t\t\t\tparts[4] = submatch[2]\n\t\t\t\t\tparts[5] = undefined // no column when eval\n\t\t\t\t} else if (i === 0 && !parts[5] && !isUndefined(ex.columnNumber)) {\n\t\t\t\t\t// FireFox uses this awesome columnNumber property for its top frame\n\t\t\t\t\t// Also note, Firefox's column number is 0-based and everything else expects 1-based,\n\t\t\t\t\t// so adding 1\n\t\t\t\t\t// NOTE: this hack doesn't work if top-most frame is eval\n\t\t\t\t\tstack[0].column = ex.columnNumber + 1\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[2] ? parts[2].split(',') : [],\n\t\t\t\t\tcolumn: parts[5] ? +parts[5] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (!element.func && element.line) {\n\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t}\n\t\t\tstack.push(element)\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Computes stack trace information from the stacktrace property.\n\t * Opera 10+ uses this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStacktraceProp(ex) {\n\t\t// Access and store the stacktrace property before doing ANYTHING\n\t\t// else to it because Opera is not very good at providing it\n\t\t// reliably in other circumstances.\n\t\tvar stacktrace = ex.stacktrace\n\t\tif (!stacktrace) {\n\t\t\treturn\n\t\t}\n\n\t\tvar opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^\\)]+))\\((.*)\\))? in (.*):\\s*$/i\n\t\tvar lines = stacktrace.split('\\n')\n\t\tvar stack = []\n\t\tvar parts\n\n\t\tfor (var line = 0; line < lines.length; line += 2) {\n\t\t\tvar element\n\t\t\tif (opera10Regex.exec(lines[line])) {\n\t\t\t\tparts = opera10Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (opera11Regex.exec(lines[line])) {\n\t\t\t\tparts = opera11Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[5] ? parts[5].split(',') : [],\n\t\t\t\t\tcolumn: +parts[2],\n\t\t\t\t\tfunc: parts[3] || parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[6],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (element) {\n\t\t\t\tif (!element.func && element.line) {\n\t\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\telement.context = [lines[line + 1]]\n\n\t\t\t\tstack.push(element)\n\t\t\t}\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * NOT TESTED.\n\t * Computes stack trace information from an error message that includes\n\t * the stack trace.\n\t * Opera 9 and earlier use this method if the option to show stack\n\t * traces is turned on in opera:config.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromOperaMultiLineMessage(ex) {\n\t\t// TODO: Clean this function up\n\t\t// Opera includes a stack trace into the exception message. An example is:\n\t\t//\n\t\t// Statement on line 3: Undefined variable: undefinedFunc\n\t\t// Backtrace:\n\t\t//   Line 3 of linked script file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.js:\n\t\t//   In function zzz\n\t\t//         undefinedFunc(a);\n\t\t//   Line 7 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function yyy\n\t\t//           zzz(x, y, z);\n\t\t//   Line 3 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function xxx\n\t\t//           yyy(a, a, a);\n\t\t//   Line 1 of function script\n\t\t//     try { xxx('hi'); return false; } catch(ex) { report(ex); }\n\t\t//   ...\n\n\t\tvar lines = ex.message.split('\\n')\n\t\tif (lines.length < 4) {\n\t\t\treturn\n\t\t}\n\n\t\tvar lineRE1 = /^\\s*Line (\\d+) of linked script ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE2 = /^\\s*Line (\\d+) of inline#(\\d+) script in ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE3 = /^\\s*Line (\\d+) of function script\\s*$/i\n\t\tvar stack = []\n\t\tvar scripts =\n\t\t\twindow &&\n\t\t\twindow.document &&\n\t\t\twindow.document.getElementsByTagName('script')\n\t\tvar inlineScriptBlocks = []\n\t\tvar parts\n\n\t\tfor (var s in scripts) {\n\t\t\tif (has(scripts, s) && !scripts[s].src) {\n\t\t\t\tinlineScriptBlocks.push(scripts[s])\n\t\t\t}\n\t\t}\n\n\t\tfor (var line = 2; line < lines.length; line += 2) {\n\t\t\tvar item\n\t\t\tif (lineRE1.exec(lines[line])) {\n\t\t\t\tparts = lineRE1.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (lineRE2.exec(lines[line])) {\n\t\t\t\tparts = lineRE2.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined, // TODO: Check to see if inline#1 (+parts[2]) points to the script number or column number.\n\t\t\t\t\tfunc: parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else if (lineRE3.exec(lines[line])) {\n\t\t\t\tparts = lineRE3.exec(lines[line])\n\t\t\t\tvar url = window.location.href.replace(/#.*$/, '')\n\t\t\t\titem = {\n\t\t\t\t\turl,\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: '',\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item) {\n\t\t\t\tif (!item.func) {\n\t\t\t\t\titem.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\titem.context = [lines[line + 1]]\n\t\t\t\tstack.push(item)\n\t\t\t}\n\t\t}\n\t\tif (!stack.length) {\n\t\t\treturn // could not parse multiline exception message as Opera stack trace\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: lines[0],\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Adds information about the first frame to incompvare stack traces.\n\t * Safari and IE require this to get compvare data on the first frame.\n\t * @param {StackTrace} stackInfo Stack trace information from\n\t * one of the compute* methods.\n\t * @param {string=} url The URL of the script that caused an error.\n\t * @param {(number|string)=} lineNo The line number of the script that\n\t * caused an error.\n\t * @param {string=} message The error generated by the browser, which\n\t * hopefully contains the name of the object that caused the error.\n\t * @return {boolean} Whether or not the stack information was\n\t * augmented.\n\t * @memberof computeStackTrace\n\t */\n\tfunction augmentStackTraceWithInitialElement(\n\t\tstackInfo,\n\t\turl,\n\t\tlineNo,\n\t\tmessage,\n\t) {\n\t\tvar initial = {\n\t\t\turl,\n\t\t\tline: lineNo ? +lineNo : undefined,\n\t\t}\n\n\t\tif (initial.url && initial.line) {\n\t\t\tstackInfo.incompvare = false\n\n\t\t\tvar stack = stackInfo.stack\n\t\t\tif (stack.length > 0) {\n\t\t\t\tif (stack[0].url === initial.url) {\n\t\t\t\t\tif (stack[0].line === initial.line) {\n\t\t\t\t\t\treturn false // already in stack trace\n\t\t\t\t\t}\n\t\t\t\t\tif (!stack[0].line && stack[0].func === initial.func) {\n\t\t\t\t\t\tstack[0].line = initial.line\n\t\t\t\t\t\tstack[0].context = initial.context\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstack.unshift(initial)\n\t\t\tstackInfo.partial = true\n\t\t\treturn true\n\t\t}\n\t\tstackInfo.incompvare = true\n\n\t\treturn false\n\t}\n\n\t/**\n\t * Computes stack trace information by walking the arguments.caller\n\t * chain at the time the exception occurred. This will cause earlier\n\t * frames to be missed but is the only way to get any stack trace in\n\t * Safari and IE. The top frame is restored by\n\t * {@link augmentStackTraceWithInitialElement}.\n\t * @param {Error} ex\n\t * @param {number} depth\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceByWalkingCallerChain(ex, depth) {\n\t\tvar functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i\n\t\tvar stack = []\n\t\tvar funcs = {}\n\t\tvar recursion = false\n\t\tvar parts\n\t\tvar item\n\n\t\tfor (\n\t\t\tvar curr = computeStackTraceByWalkingCallerChain.caller;\n\t\t\tcurr && !recursion;\n\t\t\tcurr = curr.caller\n\t\t) {\n\t\t\tif (curr === computeStackTrace || curr === report) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\titem = {\n\t\t\t\targs: [],\n\t\t\t\tcolumn: undefined,\n\t\t\t\tfunc: UNKNOWN_FUNCTION,\n\t\t\t\tline: undefined,\n\t\t\t\turl: undefined,\n\t\t\t}\n\n\t\t\tparts = functionName.exec(curr.toString())\n\t\t\tif (curr.name) {\n\t\t\t\titem.func = curr.name\n\t\t\t} else if (parts) {\n\t\t\t\titem.func = parts[1]\n\t\t\t}\n\n\t\t\tif (typeof item.func === 'undefined') {\n\t\t\t\titem.func = parts\n\t\t\t\t\t? parts.input.substring(0, parts.input.indexOf('{'))\n\t\t\t\t\t: undefined\n\t\t\t}\n\n\t\t\tif (funcs[curr + '']) {\n\t\t\t\trecursion = true\n\t\t\t} else {\n\t\t\t\tfuncs[curr + ''] = true\n\t\t\t}\n\n\t\t\tstack.push(item)\n\t\t}\n\n\t\tif (depth) {\n\t\t\tstack.splice(0, depth)\n\t\t}\n\n\t\tvar result = {\n\t\t\tstack,\n\t\t\tmessage: ex.message,\n\t\t\tname: ex.name,\n\t\t}\n\t\taugmentStackTraceWithInitialElement(\n\t\t\tresult,\n\t\t\tex.sourceURL || ex.fileName,\n\t\t\tex.line || ex.lineNumber,\n\t\t\tex.message || ex.description,\n\t\t)\n\t\treturn result\n\t}\n\n\t/**\n\t * Computes a stack trace for an exception.\n\t * @param {Error} ex\n\t * @param {(string|number)=} depth\n\t * @memberof computeStackTrace\n\t */\n\tfunction doComputeStackTrace(ex, depth) {\n\t\tvar stack\n\t\tvar normalizedDepth = depth === undefined ? 0 : +depth\n\n\t\ttry {\n\t\t\t// This must be tried first because Opera 10 *destroys*\n\t\t\t// its stacktrace property if you try to access the stack\n\t\t\t// property first!!\n\t\t\tstack = computeStackTraceFromStacktraceProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromStackProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromOperaMultiLineMessage(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceByWalkingCallerChain(ex, normalizedDepth + 1)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t\tstack: [],\n\t\t}\n\t}\n\n\t/**\n\t * Logs a stacktrace starting from the previous call and working down.\n\t * @param {(number|string)=} depth How many frames deep to trace.\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceOfCaller(depth) {\n\t\tvar currentDepth = (depth === undefined ? 0 : +depth) + 1 // \"+ 1\" because \"ofCaller\" should drop one frame\n\t\ttry {\n\t\t\tthrow new Error()\n\t\t} catch (ex) {\n\t\t\treturn computeStackTrace(ex, currentDepth + 1)\n\t\t}\n\t}\n\n\tdoComputeStackTrace.augmentStackTraceWithInitialElement = augmentStackTraceWithInitialElement\n\tdoComputeStackTrace.computeStackTraceFromStackProp = computeStackTraceFromStackProp\n\tdoComputeStackTrace.ofCaller = computeStackTraceOfCaller\n\n\treturn doComputeStackTrace\n})()\nvar ERROR_TYPES_RE = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/\nfunction extractMessage(ex) {\n\tconst message = ex && ex.message\n\t// console.log('message',message)\n\tif (!message) {\n\t\treturn 'No error message'\n\t}\n\tif (message.error && typeof message.error.message === 'string') {\n\t\treturn message.error.message\n\t}\n\n\treturn message\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar xhrProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalXhrRequest\nexport function startXhrProxy() {\n\tif (!xhrProxySingleton) {\n\t\tproxyXhr()\n\t\txhrProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn xhrProxySingleton\n}\n\nexport function resetXhrProxy() {\n\tif (xhrProxySingleton) {\n\t\txhrProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.request = originalXhrRequest\n\t}\n}\n\nfunction proxyXhr() {\n\toriginalXhrRequest = sdk.request\n\tsdk.request = function () {\n\t\tvar dataflux_xhr = {\n\t\t\tmethod: arguments[0].method || 'GET',\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.XHR,\n\t\t\tresponseType: arguments[0].responseType || 'text',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify(res.data)\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalXhrRequest.apply(this, arguments)\n\t}\n}\n","export class Observable {\n\tconstructor() {\n\t\tthis.observers = []\n\t}\n\tsubscribe(f) {\n\t\tthis.observers.push(f)\n\t}\n\tnotify(data) {\n\t\tthis.observers.forEach(function (observer) {\n\t\t\tobserver(data)\n\t\t})\n\t}\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar downloadProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalDownloadRequest\nexport function startDownloadProxy() {\n\tif (!downloadProxySingleton) {\n\t\tproxyDownload()\n\t\tdownloadProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn downloadProxySingleton\n}\n\nexport function resetDownloadProxy() {\n\tif (downloadProxySingleton) {\n\t\tdownloadProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.downloadFile = originalDownloadRequest\n\t}\n}\n\nfunction proxyDownload() {\n\toriginalDownloadRequest = sdk.downloadFile\n\tsdk.downloadFile = function () {\n\t\tvar dataflux_xhr = {\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.DOWNLOAD,\n\t\t\tresponseType: 'file',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify({\n\t\t\t\tfilePath: res.filePath,\n\t\t\t\ttempFilePath: res.tempFilePath,\n\t\t\t})\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalDownloadRequest.apply(this, arguments)\n\t}\n}\n","import { toArray, now } from '../helper/utils'\nimport { ONE_MINUTE, RequestType } from '../helper/enums'\nimport {\n\tErrorSource,\n\tformatUnknownError,\n\ttoStackTraceString,\n} from './errorTools'\nimport { computeStackTrace, report } from '../helper/tracekit'\nimport { Observable } from './observable'\nimport { isIntakeRequest } from './configuration'\nimport { resetXhrProxy, startXhrProxy } from './xhrProxy'\nimport { resetDownloadProxy, startDownloadProxy } from './downloadProxy'\nvar originalConsoleError\n\nexport function startConsoleTracking(errorObservable) {\n\toriginalConsoleError = console.error\n\tconsole.error = function () {\n\t\toriginalConsoleError.apply(console, arguments)\n\t\tvar args = toArray(arguments)\n\t\tvar message = []\n\t\targs.concat(['console error:']).forEach(function (para) {\n\t\t\tmessage.push(formatConsoleParameters(para))\n\t\t})\n\n\t\terrorObservable.notify({\n\t\t\tmessage: message.join(' '),\n\t\t\tsource: ErrorSource.CONSOLE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n}\n\nexport function stopConsoleTracking() {\n\tconsole.error = originalConsoleError\n}\n\nfunction formatConsoleParameters(param) {\n\tif (typeof param === 'string') {\n\t\treturn param\n\t}\n\tif (param instanceof Error) {\n\t\treturn toStackTraceString(computeStackTrace(param))\n\t}\n\treturn JSON.stringify(param, undefined, 2)\n}\nexport function filterErrors(configuration, errorObservable) {\n\tvar errorCount = 0\n\tvar filteredErrorObservable = new Observable()\n\terrorObservable.subscribe(function (error) {\n\t\tif (errorCount < configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify(error)\n\t\t} else if (errorCount === configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify({\n\t\t\t\tmessage:\n\t\t\t\t\t'Reached max number of errors by minute: ' +\n\t\t\t\t\tconfiguration.maxErrorsByMinute,\n\t\t\t\tsource: ErrorSource.AGENT,\n\t\t\t\tstartTime: now(),\n\t\t\t})\n\t\t}\n\t})\n\tsetInterval(function () {\n\t\terrorCount = 0\n\t}, ONE_MINUTE)\n\treturn filteredErrorObservable\n}\nvar traceKitReportHandler\n\nexport function startRuntimeErrorTracking(errorObservable) {\n\ttraceKitReportHandler = function (stackTrace, _, errorObject) {\n\t\tvar error = formatUnknownError(stackTrace, errorObject, 'Uncaught')\n\t\terrorObservable.notify({\n\t\t\tmessage: error.message,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tsource: ErrorSource.SOURCE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n\treport.subscribe(traceKitReportHandler)\n}\n\nexport function stopRuntimeErrorTracking() {\n\treport.unsubscribe(traceKitReportHandler)\n}\nvar filteredErrorsObservable\n\nexport function startAutomaticErrorCollection(configuration) {\n\tif (!filteredErrorsObservable) {\n\t\tvar errorObservable = new Observable()\n\t\ttrackNetworkError(configuration, errorObservable)\n\t\tstartConsoleTracking(errorObservable)\n\t\tstartRuntimeErrorTracking(errorObservable)\n\t\tfilteredErrorsObservable = filterErrors(configuration, errorObservable)\n\t}\n\treturn filteredErrorsObservable\n}\n\nexport function trackNetworkError(configuration, errorObservable) {\n\tstartXhrProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\tstartDownloadProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\n\tfunction handleCompleteRequest(type, request) {\n\t\tif (\n\t\t\t!isIntakeRequest(request.url, configuration) &&\n\t\t\t(isRejected(request) || isServerError(request))\n\t\t) {\n\t\t\terrorObservable.notify({\n\t\t\t\tmessage: format(type) + 'error' + request.method + ' ' + request.url,\n\t\t\t\tresource: {\n\t\t\t\t\tmethod: request.method,\n\t\t\t\t\tstatusCode: request.status,\n\t\t\t\t\turl: request.url,\n\t\t\t\t},\n\t\t\t\ttype: ErrorSource.NETWORK,\n\t\t\t\tsource: ErrorSource.NETWORK,\n\t\t\t\tstack:\n\t\t\t\t\ttruncateResponse(request.response, configuration) || 'Failed to load',\n\t\t\t\tstartTime: request.startTime,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn {\n\t\tstop: function () {\n\t\t\tresetXhrProxy()\n\t\t\tresetDownloadProxy()\n\t\t},\n\t}\n}\nfunction isRejected(request) {\n\treturn request.status === 0 && request.responseType !== 'opaque'\n}\n\nfunction isServerError(request) {\n\treturn request.status >= 500\n}\n\nfunction truncateResponse(response, configuration) {\n\tif (\n\t\tresponse &&\n\t\tresponse.length > configuration.requestErrorResponseLengthLimit\n\t) {\n\t\treturn (\n\t\t\tresponse.substring(0, configuration.requestErrorResponseLengthLimit) +\n\t\t\t'...'\n\t\t)\n\t}\n\treturn response\n}\n\nfunction format(type) {\n\tif (RequestType.XHR === type) {\n\t\treturn 'XHR'\n\t}\n\treturn RequestType.DOWNLOAD\n}\n","import { startAutomaticErrorCollection } from '../../core/errorCollection'\nimport { RumEventType } from '../../helper/enums'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n\nexport function startErrorCollection(lifeCycle, configuration) {\n\treturn doStartErrorCollection(\n\t\tlifeCycle,\n\t\tconfiguration,\n\t\tstartAutomaticErrorCollection(configuration),\n\t)\n}\n\nexport function doStartErrorCollection(lifeCycle, configuration, observable) {\n\tobservable.subscribe(function (error) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessError(error),\n\t\t)\n\t})\n}\n\nfunction processError(error) {\n\tvar rawRumEvent = {\n\t\tdate: error.startTime,\n\t\terror: {\n\t\t\tmessage: error.message,\n\t\t\tresource: error.resource,\n\t\t\tsource: error.source,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tstarttime: error.startTime,\n\t\t},\n\t\ttype: RumEventType.ERROR,\n\t}\n\treturn {\n\t\trawRumEvent: rawRumEvent,\n\t\tstartTime: error.startTime,\n\t}\n}\n","import { sdk } from '../core/sdk'\nimport { UUID } from '../helper/utils'\nimport { CLIENT_ID_TOKEN } from '../helper/enums'\nclass BaseInfo {\n\tconstructor() {\n\t\tthis.sessionId = UUID()\n\t\tthis.getDeviceInfo()\n\t\tthis.getNetWork()\n\t}\n\tgetDeviceInfo() {\n\t\tconst deviceInfo = sdk.getSystemInfoSync()\n\t\tvar osInfo = deviceInfo.system.split(' ')\n\t\tthis.deviceInfo = {\n\t\t\tscreenSize: `${deviceInfo.screenWidth}*${deviceInfo.screenHeight} `,\n\t\t\tplatform: deviceInfo.platform,\n\t\t\tplatformVersion: deviceInfo.version,\n\t\t\tosVersion: osInfo.length > 1 && osInfo[1],\n\t\t\tos: osInfo.length > 1 && osInfo[0],\n\t\t\tbrand: deviceInfo.brand,\n\t\t\tmodel: deviceInfo.model,\n\t\t\tframeworkVersion: deviceInfo.SDKVersion,\n\t\t\tpixelRatio: deviceInfo.pixelRatio,\n\t\t}\n\t}\n\tgetClientID() {\n\t\tvar clienetId = sdk.getStorageSync(CLIENT_ID_TOKEN)\n\t\tif (!clienetId) {\n\t\t\tclienetId = UUID()\n\t\t\tsdk.setStorageSync(CLIENT_ID_TOKEN, clienetId)\n\t\t}\n\t\treturn clienetId\n\t}\n\tgetNetWork() {\n\t\tsdk.getNetworkType({\n\t\t\tsuccess: (e) => {\n\t\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t\t},\n\t\t})\n\t\tsdk.onNetworkStatusChange((e) => {\n\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t})\n\t}\n\tgetSessionId() {\n\t\treturn this.sessionId\n\t}\n}\n\nexport default new BaseInfo()\n","import { extend2Lev, withSnakeCaseKeys, performDraw } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport baseInfo from '../core/baseInfo'\nfunction isTracked(configuration) {\n\treturn performDraw(configuration.sampleRate)\n}\nexport function startRumAssembly(\n\tapplicationId,\n\tconfiguration,\n\tlifeCycle,\n\tparentContexts,\n) {\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar startTime = data.startTime\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tvar viewContext = parentContexts.findViewV2(startTime)\n\n\t\t\tvar deviceContext = {\n\t\t\t\tdevice: baseInfo.deviceInfo,\n\t\t\t}\n\t\t\tif (\n\t\t\t\tisTracked(configuration) &&\n\t\t\t\t(viewContext || rawRumEvent.type === 'app')\n\t\t\t) {\n\t\t\t\tvar rumContext = {\n\t\t\t\t\t_dd: {\n\t\t\t\t\t\tsdkName: configuration.sdkName,\n\t\t\t\t\t\tsdkVersion: configuration.sdkVersion,\n\t\t\t\t\t\tenv: configuration.env,\n\t\t\t\t\t\tversion: configuration.version,\n\t\t\t\t\t},\n\t\t\t\t\ttags: configuration.tags,\n\t\t\t\t\tapplication: {\n\t\t\t\t\t\tid: applicationId,\n\t\t\t\t\t},\n\t\t\t\t\tdevice: {},\n\t\t\t\t\tdate: new Date().getTime(),\n\t\t\t\t\tuser: {\n\t\t\t\t\t\toriginId: baseInfo.getSessionId(),\n\t\t\t\t\t\tuser_id: configuration.user_id || baseInfo.getClientID(),\n\t\t\t\t\t\tis_signin: configuration.user_id ? 'T' : 'F',\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tvar rumEvent = extend2Lev(\n\t\t\t\t\trumContext,\n\t\t\t\t\tdeviceContext,\n\t\t\t\t\tviewContext,\n\t\t\t\t\trawRumEvent,\n\t\t\t\t)\n\n\t\t\t\tvar serverRumEvent = withSnakeCaseKeys(rumEvent)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.RUM_EVENT_COLLECTED, {\n\t\t\t\t\trumEvent: rumEvent,\n\t\t\t\t\tserverRumEvent: serverRumEvent,\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t)\n}\n","import { ONE_MINUTE, ONE_HOUR } from '../helper/enums'\nimport { now } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nexport var VIEW_CONTEXT_TIME_OUT_DELAY = 4 * ONE_HOUR\nexport var CLEAR_OLD_CONTEXTS_INTERVAL = ONE_MINUTE\n\nexport function startParentContexts(lifeCycle) {\n\tvar currentView\n\n\tvar previousViews = []\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_CREATED,\n\t\tfunction (currentContext) {\n\t\t\tif (currentView) {\n\t\t\t\tpreviousViews.unshift({\n\t\t\t\t\tcontext: buildCurrentViewContext(),\n\t\t\t\t\tendTime: currentContext.startTime,\n\t\t\t\t\tstartTime: currentView.startTime,\n\t\t\t\t})\n\t\t\t}\n\t\t\tcurrentView = currentContext\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_UPDATED,\n\t\tfunction (currentContext) {\n\t\t\t// A view can be updated after its end.  We have to ensure that the view being updated is the\n\t\t\t// most recently created.\n\t\t\tif (currentView.id === currentContext.id) {\n\t\t\t\tcurrentView = currentContext\n\t\t\t}\n\t\t},\n\t)\n\n\tvar clearOldContextsInterval = setInterval(function () {\n\t\tclearOldContexts(previousViews, VIEW_CONTEXT_TIME_OUT_DELAY)\n\t}, CLEAR_OLD_CONTEXTS_INTERVAL)\n\n\tfunction clearOldContexts(previousContexts, timeOutDelay) {\n\t\tvar oldTimeThreshold = now() - timeOutDelay\n\t\twhile (\n\t\t\tpreviousContexts.length > 0 &&\n\t\t\tpreviousContexts[previousContexts.length - 1].startTime < oldTimeThreshold\n\t\t) {\n\t\t\tpreviousContexts.pop()\n\t\t}\n\t}\n\n\tfunction buildCurrentViewContext() {\n\t\treturn {\n\t\t\tpage: {\n\t\t\t\tid: currentView.id,\n\t\t\t\treferrer:\n\t\t\t\t\tpreviousViews.length &&\n\t\t\t\t\tpreviousViews[previousViews.length - 1].context.page.route,\n\t\t\t\troute: currentView.route,\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction findContext(\n\t\tbuildContext,\n\t\tpreviousContexts,\n\t\tcurrentContext,\n\t\tstartTime,\n\t) {\n\t\tif (startTime === undefined) {\n\t\t\treturn currentContext ? buildContext() : undefined\n\t\t}\n\t\tif (currentContext && startTime >= currentContext.startTime) {\n\t\t\treturn buildContext()\n\t\t}\n\t\tvar flag = undefined\n\t\tpreviousContexts.forEach(function (previousContext) {\n\t\t\tif (startTime > previousContext.endTime) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tif (startTime >= previousContext.startTime) {\n\t\t\t\tflag = previousContext.context\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\t\treturn flag\n\t}\n\n\tvar parentContexts = {\n\t\tfindView: function (startTime) {\n\t\t\treturn findContext(\n\t\t\t\tbuildCurrentViewContext,\n\t\t\t\tpreviousViews,\n\t\t\t\tcurrentView,\n\t\t\t\tstartTime,\n\t\t\t)\n\t\t},\n\t\tfindViewV2: function (startTime) {\n\t\t\tvar viewContext = parentContexts.findView(startTime)\n\t\t\tif (!viewContext) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tpage: viewContext.page,\n\t\t\t}\n\t\t},\n\t\tstop: function () {\n\t\t\tclearInterval(clearOldContextsInterval)\n\t\t},\n\t}\n\treturn parentContexts\n}\n","import { RumEventType } from '../helper/enums'\n// 需要用双引号将字符串类型的field value括起来， 这里有数组标示[string, path]\n\nexport default {\n\trum_mini_app_startup: {\n\t\ttype: RumEventType.APP,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tapp_startup_type: 'app.startup_type',\n\t\t},\n\t\tfields: {\n\t\t\tapp_script_load_duration: 'app.script_load_duration',\n\t\t\tapp_code_download_duration: 'app.code_download_duration',\n\t\t\tapp_startup_duration: 'app.startup_duration',\n\t\t},\n\t},\n\trum_mini_app_page_performance: {\n\t\ttype: RumEventType.VIEW,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tpage_apdex_level: 'page.apdex_level',\n\t\t},\n\t\tfields: {\n\t\t\tpage_fmp: 'page.fmp',\n\t\t\tpage_fpt: 'page.fpt',\n\t\t\tpage_resource_load_time: 'page.loading_time',\n\t\t\tpage_onload2onshow: 'page.onload2onshow',\n\t\t\tpage_onshow2onready: 'page.onshow2onready',\n\t\t\tpage_staytime: 'page.stayTime',\n\t\t\tpage_js_error_count: 'page.error.count',\n\t\t},\n\t},\n\trum_mini_app_resource_performance: {\n\t\ttype: RumEventType.RESOURCE,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tresource_status_group: 'resource.status_group',\n\t\t\tresource_url_host: 'resource.url_host',\n\t\t\tresource_type: 'resource.type',\n\t\t\tresource_status: 'resource.status',\n\t\t\tresource_method: 'resource.method',\n\t\t\tresponse_connection: 'resource.response_connection',\n\t\t\tresponse_server: 'resource.response_server',\n\t\t\tresponse_content_type: 'resource.response_content_type',\n\t\t\tresponse_content_encoding: 'resource.response_content_encoding',\n\t\t},\n\t\tfields: {\n\t\t\tresource_size: 'resource.size',\n\t\t\tresource_load: 'resource.load',\n\t\t\tresource_dns: 'resource.dns',\n\t\t\tresource_tcp: 'resource.tcp',\n\t\t\tresource_ssl: 'resource.ssl',\n\t\t\tresource_ttfb: 'resource.ttfb',\n\t\t\tresource_trans: 'resource.trans',\n\t\t\tresource_firstbyte: 'resource.firstbyte',\n\t\t},\n\t},\n\tpage: {\n\t\ttype: RumEventType.VIEW,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tos_version: 'device.os_version',\n\t\t\torigin_id: 'user.origin_id',\n\t\t\tuserid: 'user.user_id',\n\t\t\tpage_id: 'page.id',\n\t\t\tpage_url: 'page.route',\n\t\t\tpage_referer: 'page.referer',\n\t\t\tpage_apdex_level: 'page.apdex_level',\n\t\t},\n\t\tfields: {\n\t\t\tpage_fmp: 'page.fmp',\n\t\t\tpage_fpt: 'page.fpt',\n\t\t\tpage_resource_load_time: 'page.loading_time',\n\t\t\tpage_onload2onshow: 'page.onload2onshow',\n\t\t\tpage_onshow2onready: 'page.onshow2onready',\n\t\t\tpage_staytime: 'page.stayTime',\n\t\t\tpage_js_error_count: 'page.error.count',\n\t\t},\n\t},\n\tresource: {\n\t\ttype: RumEventType.RESOURCE,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tos_version: 'device.os_version',\n\t\t\torigin_id: 'user.origin_id',\n\t\t\tuserid: 'user.user_id',\n\t\t\tpage_id: 'page.id',\n\t\t\tpage_url: 'page.route',\n\t\t\tpage_referer: 'page.referer',\n\t\t\tresource_url: 'resource.url',\n\t\t\tresource_url_host: 'resource.url_host',\n\t\t\tresource_url_path: 'resource.url_path',\n\t\t\tresource_type: 'resource.type',\n\t\t\tresource_status: 'resource.status',\n\t\t\tresource_status_group: 'resource.status_group',\n\t\t\tresource_method: 'resource.method',\n\t\t\tresponse_connection: 'resource.response_connection',\n\t\t\tresponse_server: 'resource.response_server',\n\t\t\tresponse_content_type: 'resource.response_content_type',\n\t\t\tresponse_content_encoding: 'resource.response_content_encoding',\n\t\t},\n\t\tfields: {\n\t\t\tresource_size: 'resouce.size',\n\t\t\tresource_load: 'resource.load',\n\t\t\tresource_dns: 'resource.dns',\n\t\t\tresource_tcp: 'resource.tcp',\n\t\t\tresource_ssl: 'resource.ssl',\n\t\t\tresource_ttfb: 'resource.ttfb',\n\t\t\tresource_trans: 'resource.trans',\n\t\t\tresource_firstbyte: 'resource.firstbyte',\n\t\t\trequest_header: ['string', 'request.header'],\n\t\t\tresponse_header: ['string', 'response.header'],\n\t\t\tpage_url: ['string', 'page.route'],\n\t\t\tpage_referer: ['string', 'page.referer'],\n\t\t},\n\t},\n\tjs_error: {\n\t\ttype: RumEventType.ERROR,\n\t\ttags: {\n\t\t\tapp_id: 'application.id',\n\t\t\tenv: '_dd.env',\n\t\t\tapp_version: '_dd.version',\n\t\t\tsdk_name: '_dd.sdk_name',\n\t\t\tsdk_version: '_dd.sdk_version',\n\t\t\tis_signin: 'user.is_signin',\n\t\t\tos: 'device.os',\n\t\t\tdevice: 'device.model',\n\t\t\tscreen_size: 'device.screen_size',\n\t\t\tnetwork_type: 'device.network',\n\t\t\tplatform: 'device.platform',\n\t\t\tplatform_version: 'device.platform_version',\n\t\t\tapp_framework_version: 'device.framework_version',\n\t\t\tos_version: 'device.os_version',\n\t\t\torigin_id: 'user.origin_id',\n\t\t\tuserid: 'user.user_id',\n\t\t\tpage_id: 'page.id',\n\t\t\tpage_url: 'page.route',\n\t\t\tpage_referer: 'page.referer',\n\t\t\terror_type: 'error.type',\n\t\t},\n\t\tfields: {\n\t\t\terror_starttime: 'error.starttime',\n\t\t\terror_message: ['string', 'error.message'],\n\t\t\terror_stack: ['string', 'error.stack'],\n\t\t},\n\t},\n}\n","import {\n\tfindByPath,\n\tescapeRowData,\n\tisNumber,\n\teach,\n\tisString,\n\tvalues,\n} from '../helper/utils'\nimport { sdk } from '../core/sdk'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport dataMap from './dataMap'\n// https://en.wikipedia.org/wiki/UTF-8\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nfunction addBatchPrecision(url) {\n\tif (!url) return url\n\treturn url + (url.indexOf('?') === -1 ? '?' : '&') + 'precision=ms'\n}\nvar httpRequest = function (endpointUrl, bytesLimit) {\n\tthis.endpointUrl = endpointUrl\n\tthis.bytesLimit = bytesLimit\n}\nhttpRequest.prototype = {\n\tsend: function (data) {\n\t\tvar url = addBatchPrecision(this.endpointUrl)\n\t\tsdk.request({\n\t\t\tmethod: 'POST',\n\t\t\theader: {\n\t\t\t\t'content-type': 'text/plain;charset=UTF-8',\n\t\t\t},\n\t\t\turl,\n\t\t\tdata,\n\t\t})\n\t},\n}\n\nexport var HttpRequest = httpRequest\n\nfunction batch(\n\trequest,\n\tmaxSize,\n\tbytesLimit,\n\tmaxMessageSize,\n\tflushTimeout,\n\tlifeCycle,\n) {\n\tthis.request = request\n\tthis.maxSize = maxSize\n\tthis.bytesLimit = bytesLimit\n\tthis.maxMessageSize = maxMessageSize\n\tthis.flushTimeout = flushTimeout\n\tthis.lifeCycle = lifeCycle\n\tthis.flushOnVisibilityHidden()\n\tthis.flushPeriodically()\n}\nbatch.prototype = {\n\tpushOnlyBuffer: [],\n\tupsertBuffer: {},\n\tbufferBytesSize: 0,\n\tbufferMessageCount: 0,\n\tadd: function (message) {\n\t\tthis.addOrUpdate(message)\n\t},\n\n\tupsert: function (message, key) {\n\t\tthis.addOrUpdate(message, key)\n\t},\n\n\tflush: function () {\n\t\tif (this.bufferMessageCount !== 0) {\n\t\t\tvar messages = this.pushOnlyBuffer.concat(values(this.upsertBuffer))\n\t\t\tthis.request.send(messages.join('\\n'), this.bufferBytesSize)\n\t\t\tthis.pushOnlyBuffer = []\n\t\t\tthis.upsertBuffer = {}\n\t\t\tthis.bufferBytesSize = 0\n\t\t\tthis.bufferMessageCount = 0\n\t\t}\n\t},\n\n\tprocessSendData: function (message) {\n\t\t// var data = safeJSONParse(message)\n\t\tif (!message || !message.type) return ''\n\t\tvar rowsStr = []\n\t\teach(dataMap, function (value, key) {\n\t\t\tif (value.type === message.type) {\n\t\t\t\tvar rowStr = ''\n\t\t\t\trowStr += key + ','\n\t\t\t\tvar tagsStr = []\n\t\t\t\teach(value.tags, function (value_path, _key) {\n\t\t\t\t\tvar _value = findByPath(message, value_path)\n\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (message.tags.length) {\n\t\t\t\t\t// 自定义tag\n\t\t\t\t\teach(message.tags, function (_value, _key) {\n\t\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar fieldsStr = []\n\t\t\t\teach(value.fields, function (_value, _key) {\n\t\t\t\t\tif (Array.isArray(_value) && _value.length === 2) {\n\t\t\t\t\t\tvar type = _value[0],\n\t\t\t\t\t\t\tvalue_path = _value[1]\n\t\t\t\t\t\tvar _valueData = findByPath(message, value_path)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData =\n\t\t\t\t\t\t\t\ttype === 'string'\n\t\t\t\t\t\t\t\t\t? '\"' +\n\t\t\t\t\t\t\t\t\t  _valueData.replace(/[\\\\]*\"/g, '\"').replace(/\"/g, '\\\\\"') +\n\t\t\t\t\t\t\t\t\t  '\"'\n\t\t\t\t\t\t\t\t\t: escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isString(_value)) {\n\t\t\t\t\t\tvar _valueData = findByPath(message, _value)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData = escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (tagsStr.length) {\n\t\t\t\t\trowStr += tagsStr.join(',')\n\t\t\t\t}\n\t\t\t\tif (fieldsStr.length) {\n\t\t\t\t\trowStr += ' '\n\t\t\t\t\trowStr += fieldsStr.join(',')\n\t\t\t\t}\n\t\t\t\trowStr = rowStr + ' ' + message.date\n\t\t\t\tif (fieldsStr.length) {\n\t\t\t\t\trowsStr.push(rowStr)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\tif (rowsStr.length) {\n\t\t\treturn rowsStr.join('\\n')\n\t\t} else {\n\t\t\treturn ''\n\t\t}\n\t},\n\tsizeInBytes: function (candidate) {\n\t\t// Accurate byte size computations can degrade performances when there is a lot of events to process\n\t\tif (!HAS_MULTI_BYTES_CHARACTERS.test(candidate)) {\n\t\t\treturn candidate.length\n\t\t}\n\n\t\treturn new Blob([candidate]).size\n\t},\n\n\taddOrUpdate: function (message, key) {\n\t\tvar process = this.process(message)\n\t\tif (!process.processedMessage || process.processedMessage === '') return\n\t\tif (process.messageBytesSize >= this.maxMessageSize) {\n\t\t\tconsole.warn(\n\t\t\t\t'Discarded a message whose size was bigger than the maximum allowed size' +\n\t\t\t\t\tthis.maxMessageSize +\n\t\t\t\t\t'KB.',\n\t\t\t)\n\t\t\treturn\n\t\t}\n\t\tif (this.hasMessageFor(key)) {\n\t\t\tthis.remove(key)\n\t\t}\n\t\tif (this.willReachedBytesLimitWith(process.messageBytesSize)) {\n\t\t\tthis.flush()\n\t\t}\n\t\tthis.push(process.processedMessage, process.messageBytesSize, key)\n\t\tif (this.isFull()) {\n\t\t\tthis.flush()\n\t\t}\n\t},\n\tprocess: function (message) {\n\t\tvar processedMessage = this.processSendData(message)\n\t\tvar messageBytesSize = this.sizeInBytes(processedMessage)\n\t\treturn {\n\t\t\tprocessedMessage: processedMessage,\n\t\t\tmessageBytesSize: messageBytesSize,\n\t\t}\n\t},\n\n\tpush: function (processedMessage, messageBytesSize, key) {\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\t// \\n separator at serialization\n\t\t\tthis.bufferBytesSize += 1\n\t\t}\n\t\tif (key !== undefined) {\n\t\t\tthis.upsertBuffer[key] = processedMessage\n\t\t} else {\n\t\t\tthis.pushOnlyBuffer.push(processedMessage)\n\t\t}\n\t\tthis.bufferBytesSize += messageBytesSize\n\t\tthis.bufferMessageCount += 1\n\t},\n\n\tremove: function (key) {\n\t\tvar removedMessage = this.upsertBuffer[key]\n\t\tdelete this.upsertBuffer[key]\n\t\tvar messageBytesSize = this.sizeInBytes(removedMessage)\n\t\tthis.bufferBytesSize -= messageBytesSize\n\t\tthis.bufferMessageCount -= 1\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\tthis.bufferBytesSize -= 1\n\t\t}\n\t},\n\n\thasMessageFor: function (key) {\n\t\treturn key !== undefined && this.upsertBuffer[key] !== undefined\n\t},\n\n\twillReachedBytesLimitWith: function (messageBytesSize) {\n\t\t// byte of the separator at the end of the message\n\t\treturn this.bufferBytesSize + messageBytesSize + 1 >= this.bytesLimit\n\t},\n\n\tisFull: function () {\n\t\treturn (\n\t\t\tthis.bufferMessageCount === this.maxSize ||\n\t\t\tthis.bufferBytesSize >= this.bytesLimit\n\t\t)\n\t},\n\n\tflushPeriodically: function () {\n\t\tvar _this = this\n\t\tsetTimeout(function () {\n\t\t\t_this.flush()\n\t\t\t_this.flushPeriodically()\n\t\t}, _this.flushTimeout)\n\t},\n\n\tflushOnVisibilityHidden: function () {\n\t\tvar _this = this\n\t\t/**\n\t\t * With sendBeacon, requests are guaranteed to be successfully sent during document unload\n\t\t */\n\t\t// @ts-ignore this function is not always defined\n\t\tthis.lifeCycle.subscribe(LifeCycleEventType.APP_HIDE, function () {\n\t\t\t_this.flush()\n\t\t})\n\t},\n}\n\nexport var Batch = batch\n","import { LifeCycleEventType } from '../../core/lifeCycle'\nimport { Batch, HttpRequest } from '../../core/transport'\nimport { RumEventType } from '../../helper/enums'\nexport function startRumBatch(configuration, lifeCycle) {\n\tvar batch = makeRumBatch(configuration, lifeCycle)\n\tlifeCycle.subscribe(LifeCycleEventType.RUM_EVENT_COLLECTED, function (data) {\n\t\tvar rumEvent = data.rumEvent\n\t\tvar serverRumEvent = data.serverRumEvent\n\t\tconsole.log(serverRumEvent, serverRumEvent.type, 'serverRumEvent')\n\t\tif (rumEvent.type === RumEventType.VIEW) {\n\t\t\tbatch.upsert(serverRumEvent, rumEvent.page.id)\n\t\t} else {\n\t\t\tbatch.add(serverRumEvent)\n\t\t}\n\t})\n\treturn {\n\t\tstop: function () {\n\t\t\tbatch.stop()\n\t\t},\n\t}\n}\n\nfunction makeRumBatch(configuration, lifeCycle) {\n\tvar primaryBatch = createRumBatch(configuration.datakitUrl, lifeCycle)\n\n\tfunction createRumBatch(endpointUrl, lifeCycle) {\n\t\treturn new Batch(\n\t\t\tnew HttpRequest(endpointUrl, configuration.batchBytesLimit),\n\t\t\tconfiguration.maxBatchSize,\n\t\t\tconfiguration.batchBytesLimit,\n\t\t\tconfiguration.maxMessageSize,\n\t\t\tconfiguration.flushTimeout,\n\t\t\tlifeCycle,\n\t\t)\n\t}\n\n\tvar stopped = false\n\treturn {\n\t\tadd: function (message) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.add(message)\n\t\t},\n\t\tstop: function () {\n\t\t\tstopped = true\n\t\t},\n\t\tupsert: function (message, key) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.upsert(message, key)\n\t\t},\n\t}\n}\n","import { now, throttle, UUID } from '../../helper/utils'\nimport { trackEventCounts } from '../trackEventCounts'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\n\nexport function rewritePage(configuration, lifeCycle) {\n\tconst originPage = Page\n\n\tPage = function (page) {\n\t\t// 合并方法，插入记录脚本\n\t\tvar currentView,\n\t\t\tstartTime = now()\n\t\t;['onUnload', 'onShow', 'onHide', 'onReady', 'onLoad'].forEach(\n\t\t\t(methodName) => {\n\t\t\t\tconst userDefinedMethod = page[methodName] // 暂存用户定义的方法\n\t\t\t\tpage[methodName] = function (options) {\n\t\t\t\t\tif (methodName === 'onShow' || methodName === 'onLoad') {\n\t\t\t\t\t\tif (typeof currentView === 'undefined') {\n\t\t\t\t\t\t\tconst activePage = getActivePage()\n\t\t\t\t\t\t\tcurrentView = newView(\n\t\t\t\t\t\t\t\tlifeCycle,\n\t\t\t\t\t\t\t\tactivePage && activePage.route,\n\t\t\t\t\t\t\t\tstartTime,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcurrentView && currentView.setLoadEventEnd(methodName)\n\t\t\t\t\tif (\n\t\t\t\t\t\t(methodName === 'onUnload' ||\n\t\t\t\t\t\t\tmethodName === 'onHide' ||\n\t\t\t\t\t\t\tmethodName === 'onShow') &&\n\t\t\t\t\t\tcurrentView\n\t\t\t\t\t) {\n\t\t\t\t\t\tcurrentView.triggerUpdate()\n\t\t\t\t\t\tif (methodName === 'onUnload') {\n\t\t\t\t\t\t\tcurrentView.end()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn userDefinedMethod && userDefinedMethod.call(this, options)\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t\treturn originPage(page)\n\t}\n}\nfunction newView(lifeCycle, route, startTime) {\n\tif (typeof startTime === 'undefined') {\n\t\tstartTime = now()\n\t}\n\tvar id = UUID()\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t}\n\tvar documentVersion = 0\n\tvar loadingTime\n\tvar showTime\n\tvar onload2onshowTime\n\tvar onshow2onready\n\tvar stayTime\n\tvar fpt, fmp\n\tlifeCycle.notify(LifeCycleEventType.VIEW_CREATED, {\n\t\tid,\n\t\tstartTime,\n\t\troute,\n\t})\n\tvar scheduleViewUpdate = throttle(\n\t\ttriggerViewUpdate,\n\t\tTHROTTLE_VIEW_UPDATE_PERIOD,\n\t\t{\n\t\t\tleading: false,\n\t\t},\n\t)\n\tvar cancelScheduleViewUpdate = scheduleViewUpdate.cancel\n\tvar _trackEventCounts = trackEventCounts(\n\t\tlifeCycle,\n\t\tfunction (newEventCounts) {\n\t\t\teventCounts = newEventCounts\n\t\t\tscheduleViewUpdate()\n\t\t},\n\t)\n\tvar stopEventCountsTracking = _trackEventCounts.stop\n\tvar _trackFptTime = trackFptTime(lifeCycle, function (duration) {\n\t\tfpt = duration\n\t\tscheduleViewUpdate()\n\t})\n\tvar stopFptTracking = _trackFptTime.stop\n\tvar setLoadEventEnd = function (type) {\n\t\tconsole.log(type, 'type')\n\t\tif (type === 'onLoad') {\n\t\t\tloadingTime = now()\n\t\t} else if (type === 'onShow') {\n\t\t\tshowTime = now()\n\t\t\tif (\n\t\t\t\ttypeof onload2onshowTime === 'undefined' &&\n\t\t\t\ttypeof loadingTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonload2onshowTime = showTime - loadingTime\n\t\t\t}\n\t\t} else if (type === 'onReady') {\n\t\t\tif (\n\t\t\t\ttypeof onshow2onready === 'undefined' &&\n\t\t\t\ttypeof showTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonshow2onready = now() - showTime\n\t\t\t}\n\t\t\tif (typeof fmp === 'undefined') {\n\t\t\t\tfmp = now() - startTime // 从开发者角度看，小程序首屏渲染完成的标志是首页 Page.onReady 事件触发。\n\t\t\t}\n\t\t} else if (type === 'onHide' || type === 'onUnload') {\n\t\t\tif (typeof showTime !== 'undefined') {\n\t\t\t\tstayTime = now() - showTime\n\t\t\t}\n\t\t}\n\t\tscheduleViewUpdate()\n\t}\n\tfunction triggerViewUpdate() {\n\t\tdocumentVersion += 1\n\t\tlifeCycle.notify(LifeCycleEventType.VIEW_UPDATED, {\n\t\t\tdocumentVersion: documentVersion,\n\t\t\teventCounts: eventCounts,\n\t\t\tid: id,\n\t\t\tloadingTime: loadingTime,\n\t\t\tstayTime,\n\t\t\tonload2onshowTime,\n\t\t\tonshow2onready,\n\t\t\tfmp,\n\t\t\tfpt,\n\t\t\tstartTime: startTime,\n\t\t\troute: route,\n\t\t\tduration: now() - startTime,\n\t\t})\n\t}\n\treturn {\n\t\tscheduleUpdate: scheduleViewUpdate,\n\t\tsetLoadEventEnd,\n\t\ttriggerUpdate: function () {\n\t\t\t// cancel any pending view updates execution\n\t\t\tcancelScheduleViewUpdate()\n\t\t\ttriggerViewUpdate()\n\t\t},\n\t\tend: function () {\n\t\t\tstopEventCountsTracking()\n\t\t\tstopFptTracking()\n\t\t\tcancelScheduleViewUpdate()\n\t\t},\n\t}\n}\nfunction trackFptTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\tconst firstRenderEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\t\t\tif (typeof firstRenderEntity !== 'undefined') {\n\t\t\t\tcallback(firstRenderEntity.duration)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction getActivePage() {\n\tconst curPages = getCurrentPages()\n\tif (curPages.length) {\n\t\treturn curPages[curPages.length - 1]\n\t}\n\treturn {}\n}\n","import { noop } from '../helper/utils'\nimport { RumEventType } from '../helper/enums'\nimport { LifeCycleEventType } from '../core/lifeCycle'\n\nexport function trackEventCounts(lifeCycle, callback) {\n\tif (typeof callback === 'undefined') {\n\t\tcallback = noop\n\t}\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t}\n\n\tvar subscription = lifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tswitch (rawRumEvent.type) {\n\t\t\t\tcase RumEventType.ERROR:\n\t\t\t\t\teventCounts.errorCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t\tcase RumEventType.RESOURCE:\n\t\t\t\t\teventCounts.resourceCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t},\n\t)\n\n\treturn {\n\t\tstop: function () {\n\t\t\tsubscription.unsubscribe()\n\t\t},\n\t\teventCounts: eventCounts,\n\t}\n}\n","import { rewritePage } from './index'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nexport function startViewCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessViewUpdate(view),\n\t\t)\n\t})\n\n\treturn rewritePage(configuration, lifeCycle)\n}\nfunction processViewUpdate(view) {\n\tvar apdexLevel\n\tif (view.fmp) {\n\t\tapdexLevel = parseInt(Number(view.fmp) / 1000)\n\t\tapdexLevel = apdexLevel > 9 ? 9 : apdexLevel\n\t}\n\tvar viewEvent = {\n\t\t_dd: {\n\t\t\tdocumentVersion: view.documentVersion,\n\t\t},\n\t\tdate: view.startTime,\n\t\ttype: RumEventType.VIEW,\n\t\tpage: {\n\t\t\t// action: {\n\t\t\t//   count: view.eventCounts.userActionCount\n\t\t\t// },\n\n\t\t\terror: {\n\t\t\t\tcount: view.eventCounts.errorCount,\n\t\t\t},\n\t\t\t// firstInputDelay: msToNs(view.timings.firstInputDelay),\n\t\t\tloadingTime: msToNs(view.loadingTime),\n\t\t\tstayTime: msToNs(view.stayTime),\n\t\t\tonload2onshow: msToNs(view.onload2onshowTime),\n\t\t\tonshow2onready: msToNs(view.onshow2onready),\n\t\t\tfpt: msToNs(view.fpt),\n\t\t\tfmp: msToNs(view.fmp),\n\t\t\tapdexLevel,\n\t\t\t// longTask: {\n\t\t\t//   count: view.eventCounts.longTaskCount\n\t\t\t// },\n\t\t\t// resource: {\n\t\t\t//   count: view.eventCounts.resourceCount\n\t\t\t// },\n\t\t\ttimeSpent: msToNs(view.duration),\n\t\t},\n\t}\n\treturn {\n\t\trawRumEvent: viewEvent,\n\t\tstartTime: view.startTime,\n\t}\n}\n","import { msToNs, toArray, extend } from '../../helper/utils'\nimport { isIntakeRequest } from '../../core/configuration'\n\nfunction areInOrder() {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n\nexport function computePerformanceResourceDuration(entry) {\n\t// Safari duration is always 0 on timings blocked by cross origin policies.\n\tif (entry.startTime < entry.responseEnd) {\n\t\treturn msToNs(entry.responseEnd - entry.startTime)\n\t}\n}\n\n//  interface PerformanceResourceDetails {\n//   redirect?: PerformanceResourceDetailsElement\n//   dns?: PerformanceResourceDetailsElement\n//   connect?: PerformanceResourceDetailsElement\n//   ssl?: PerformanceResourceDetailsElement\n//   firstByte: PerformanceResourceDetailsElement\n//   download: PerformanceResourceDetailsElement\n//   fmp:\n// }\n// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\n//  navigationStart：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n\n// ·   unloadEventStart：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   unloadEventEnd：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   redirectStart：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   redirectEnd：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   fetchStart：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n\n// ·   domainLookupStart：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   domainLookupEnd：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   connectStart：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n\n// ·   connectEnd：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n\n// ·   secureConnectionStart：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n\n// ·   requestStart：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n\n// ·   responseStart：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n\n// ·   responseEnd：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n\n// ·   domLoading：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domInteractive：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventStart：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventEnd：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n\n// ·   domComplete：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n\n// ·   loadEventStart：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n// ·   loadEventEnd：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0\nexport function computePerformanceResourceDetails(entry) {\n\tvar validEntry = toValidEntry(entry)\n\n\tif (!validEntry) {\n\t\treturn undefined\n\t}\n\n\tvar startTime = validEntry.startTime,\n\t\tfetchStart = validEntry.fetchStart,\n\t\tredirectStart = validEntry.redirectStart,\n\t\tredirectEnd = validEntry.redirectEnd,\n\t\tdomainLookupStart = validEntry.domainLookupStart,\n\t\tdomainLookupEnd = validEntry.domainLookupEnd,\n\t\tconnectStart = validEntry.connectStart,\n\t\tSSLconnectionStart = validEntry.SSLconnectionStart,\n\t\tSSLconnectionEnd = validEntry.SSLconnectionEnd,\n\t\tconnectEnd = validEntry.connectEnd,\n\t\trequestStart = validEntry.requestStart,\n\t\tresponseStart = validEntry.responseStart,\n\t\tresponseEnd = validEntry.responseEnd\n\tvar details = {\n\t\tfirstbyte: formatTiming(startTime, domainLookupStart, responseStart),\n\t\ttrans: formatTiming(startTime, responseStart, responseEnd),\n\t\tttfb: formatTiming(startTime, requestStart, responseStart),\n\t}\n\t// Make sure a connection occurred\n\tif (connectEnd !== fetchStart) {\n\t\tdetails.tcp = formatTiming(startTime, connectStart, connectEnd)\n\n\t\t// Make sure a secure connection occurred\n\t\tif (areInOrder(connectStart, secureConnectionStart, SSLconnectionEnd)) {\n\t\t\tdetails.ssl = formatTiming(\n\t\t\t\tstartTime,\n\t\t\t\tSSLconnectionStart,\n\t\t\t\tSSLconnectionEnd,\n\t\t\t)\n\t\t}\n\t}\n\n\t// Make sure a domain lookup occurred\n\tif (domainLookupEnd !== fetchStart) {\n\t\tdetails.dns = formatTiming(startTime, domainLookupStart, domainLookupEnd)\n\t}\n\n\tif (hasRedirection(entry)) {\n\t\tdetails.redirect = formatTiming(startTime, redirectStart, redirectEnd)\n\t}\n\n\treturn details\n}\n\nexport function toValidEntry(entry) {\n\t// Ensure timings are in the right order. On top of filtering out potential invalid\n\t// RumPerformanceResourceTiming, it will ignore entries from requests where timings cannot be\n\t// collected, for example cross origin requests without a \"Timing-Allow-Origin\" header allowing\n\t// it.\n\t// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n\t// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n\t// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n\t// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n\t// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n\t// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n\t// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n\t// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n\t// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n\t// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n\t// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n\t// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n\t// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\tif (\n\t\t!areInOrder(\n\t\t\tentry.startTime,\n\t\t\tentry.fetchStart,\n\t\t\tentry.domainLookupStart,\n\t\t\tentry.domainLookupEnd,\n\t\t\tentry.connectStart,\n\t\t\tentry.connectEnd,\n\t\t\tentry.requestStart,\n\t\t\tentry.responseStart,\n\t\t\tentry.responseEnd,\n\t\t)\n\t) {\n\t\treturn undefined\n\t}\n\n\tif (!hasRedirection(entry)) {\n\t\treturn entry\n\t}\n\n\tvar redirectStart = entry.redirectStart\n\tvar redirectEnd = entry.redirectEnd\n\t// Firefox doesn't provide redirect timings on cross origin requests.\n\t// Provide a default for those.\n\tif (redirectStart < entry.startTime) {\n\t\tredirectStart = entry.startTime\n\t}\n\tif (redirectEnd < entry.startTime) {\n\t\tredirectEnd = entry.fetchStart\n\t}\n\n\t// Make sure redirect timings are in order\n\tif (\n\t\t!areInOrder(entry.startTime, redirectStart, redirectEnd, entry.fetchStart)\n\t) {\n\t\treturn undefined\n\t}\n\treturn extend({}, entry, {\n\t\tredirectEnd: redirectEnd,\n\t\tredirectStart: redirectStart,\n\t})\n\t// return {\n\t//   ...entry,\n\t//   redirectEnd,\n\t//   redirectStart\n\t// }\n}\n\nfunction hasRedirection(entry) {\n\t// The only time fetchStart is different than startTime is if a redirection occurred.\n\treturn entry.fetchStart !== entry.startTime\n}\n\nfunction formatTiming(origin, start, end) {\n\treturn msToNs(end - start)\n}\n\nexport function computeSize(entry) {\n\t// Make sure a request actually occurred\n\tif (entry.startTime < entry.responseStart) {\n\t\treturn entry.receivedBytedCount\n\t}\n\treturn undefined\n}\n\nexport function isAllowedRequestUrl(configuration, url) {\n\treturn url && !isIntakeRequest(url, configuration)\n}\n","import { startXhrProxy } from '../core/xhrProxy'\nimport { startDownloadProxy } from '../core/downloadProxy'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { isObject } from '../helper/utils'\nimport { isAllowedRequestUrl } from '../rumEventsCollection/resource/resourceUtils'\nvar nextRequestIndex = 1\n\nexport function startRequestCollection(lifeCycle, configuration) {\n\ttrackXhr(lifeCycle, configuration)\n\ttrackDownload(lifeCycle, configuration)\n}\nfunction parseHeader(header) {\n\t// 大小写兼容\n\tif (!isObject(header)) return header\n\tvar res = {}\n\tObject.keys(header).forEach(function (key) {\n\t\tres[key.toLowerCase()] = header[key]\n\t})\n\treturn res\n}\nfunction getHeaderString(header) {\n\tif (!isObject(header)) return header\n\tvar headerStr = ''\n\tObject.keys(header).forEach(function (key) {\n\t\theaderStr += key + ':' + header[key] + ';'\n\t})\n\treturn headerStr\n}\nexport function trackXhr(lifeCycle, configuration) {\n\tvar xhrProxy = startXhrProxy()\n\txhrProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\txhrProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tvar header = parseHeader(context.header || {})\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\tmethod: context.method,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tresponseConnection: header['connection'],\n\t\t\t\tresponseServer: header['server'],\n\t\t\t\tresponseHeader: getHeaderString(header),\n\t\t\t\tresponseContentType: header['content-type'],\n\t\t\t\tresponseContentEncoding: header['content-encoding'],\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn xhrProxy\n}\nexport function trackDownload(lifeCycle, configuration) {\n\tvar dwonloadProxy = startDownloadProxy()\n\tdwonloadProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\tdwonloadProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tvar header = parseHeader(context.header || {})\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tresponseConnection: header['connection'],\n\t\t\t\tresponseServer: header['server'],\n\t\t\t\tresponseHeader: getHeaderString(header),\n\t\t\t\tresponseContentType: header['content-type'],\n\t\t\t\tresponseContentEncoding: header['content-encoding'],\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn dwonloadProxy\n}\nfunction getNextRequestIndex() {\n\tvar result = nextRequestIndex\n\tnextRequestIndex += 1\n\treturn result\n}\n","import {\n\tcomputePerformanceResourceDuration,\n\tcomputePerformanceResourceDetails,\n\tcomputeSize,\n} from './resourceUtils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { msToNs, extend2Lev, urlParse } from '../../helper/utils'\nimport { RumEventType } from '../../helper/enums'\nexport function startResourceCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.REQUEST_COMPLETED, function (request) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessRequest(request),\n\t\t)\n\t})\n}\nfunction getStatusGroup(status) {\n\tif (!status) return status\n\treturn (\n\t\tString(status).substr(0, 1) + String(status).substr(1).replace(/\\d*/g, 'x')\n\t)\n}\nfunction processRequest(request) {\n\tvar type = request.type\n\n\tvar timing = request.performance\n\tvar correspondingTimingOverrides = timing\n\t\t? computePerformanceEntryMetricsV2(timing)\n\t\t: undefined\n\tvar urlObj = urlParse(request.url).getParse()\n\tvar startTime = request.startTime\n\tvar resourceEvent = extend2Lev(\n\t\t{\n\t\t\tdate: startTime,\n\t\t\tresource: {\n\t\t\t\ttype: type,\n\t\t\t\tload: msToNs(request.duration),\n\t\t\t\tmethod: request.method,\n\t\t\t\tstatus: request.status,\n\t\t\t\tstatusGroup: getStatusGroup(request.status),\n\t\t\t\turl: request.url,\n\t\t\t\turlHost: urlObj.Host,\n\t\t\t\turlPath: urlObj.Path,\n\t\t\t\tresponseHeader: request.responseHeader,\n\t\t\t\tresponseConnection: request.responseConnection,\n\t\t\t\tresponseServer: request.responseServer,\n\t\t\t\tresponseContentType: request.responseContentType,\n\t\t\t\tresponseContentEncoding: request.responseContentEncoding,\n\t\t\t},\n\t\t\ttype: RumEventType.RESOURCE,\n\t\t},\n\t\tcorrespondingTimingOverrides,\n\t)\n\treturn { startTime: startTime, rawRumEvent: resourceEvent }\n}\nfunction computePerformanceEntryMetricsV2(timing) {\n\treturn {\n\t\tresource: extend2Lev(\n\t\t\t{},\n\t\t\t{\n\t\t\t\tload: computePerformanceResourceDuration(timing),\n\t\t\t\tsize: computeSize(timing),\n\t\t\t},\n\t\t\tcomputePerformanceResourceDetails(timing),\n\t\t),\n\t}\n}\n","import { throttle, now, areInOrder } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\nexport const startupTypes = {\n\tCOLD: 'cold',\n\tHOT: 'hot',\n}\nexport function rewriteApp(configuration, lifeCycle) {\n\tconst originApp = App\n\tvar appInfo = {\n\t\tisStartUp: false, // 是否启动\n\t}\n\tvar startTime\n\tApp = function (app) {\n\t\tstartTime = now()\n\t\t// 合并方法，插入记录脚本\n\t\t;['onLaunch', 'onShow', 'onHide'].forEach((methodName) => {\n\t\t\tconst userDefinedMethod = app[methodName] // 暂存用户定义的方法\n\t\t\tapp[methodName] = function (options) {\n\t\t\t\tconsole.log(methodName, 'methodName')\n\t\t\t\tif (methodName === 'onLaunch') {\n\t\t\t\t\tappInfo.isStartUp = true\n\t\t\t\t\tappInfo.isHide = false\n\t\t\t\t\tappInfo.startupType = startupTypes.COLD\n\t\t\t\t} else if (methodName === 'onShow') {\n\t\t\t\t\tif (appInfo.isStartUp && appInfo.isHide) {\n\t\t\t\t\t\t// 判断是热启动\n\t\t\t\t\t\tappInfo.startupType = startupTypes.HOT\n\t\t\t\t\t\tscheduleAppUpdate()\n\t\t\t\t\t}\n\t\t\t\t} else if (methodName === 'onHide') {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_HIDE)\n\t\t\t\t\tappInfo.isHide = true\n\t\t\t\t}\n\t\t\t\treturn userDefinedMethod && userDefinedMethod.call(this, options)\n\t\t\t}\n\t\t})\n\t\treturn originApp(app)\n\t}\n\tstartPerformanceObservable(lifeCycle, function (data) {\n\t\tappInfo = {\n\t\t\t...appInfo,\n\t\t\t...data,\n\t\t}\n\t\tscheduleAppUpdate()\n\t})\n\tvar scheduleAppUpdate = throttle(appUpdate, THROTTLE_VIEW_UPDATE_PERIOD, {\n\t\tleading: false,\n\t})\n\tfunction appUpdate() {\n\t\tlifeCycle.notify(LifeCycleEventType.APP_UPDATE, {\n\t\t\tstartupDuration: appInfo.startupDuration,\n\t\t\tscriptLoadDuration: appInfo.scriptLoadDuration,\n\t\t\tcodeDownloadDuration: appInfo.codeDownloadDuration,\n\t\t\tstartupType: appInfo.startupType,\n\t\t\tstartTime,\n\t\t\tduration: now() - startTime,\n\t\t})\n\t}\n}\n\nfunction startPerformanceObservable(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\t// 过滤掉其他页面监听，只保留首次启动\n\t\t\tvar startupDuration, scriptLoadDuration, codeDownloadDuration\n\t\t\tconst launchEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'navigation' &&\n\t\t\t\t\tentity.navigationType === 'appLaunch',\n\t\t\t)\n\t\t\tif (typeof launchEntity !== 'undefined') {\n\t\t\t\tstartupDuration = launchEntity.duration\n\t\t\t}\n\t\t\tconst scriptentity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'script' && entity.name === 'evaluateScript',\n\t\t\t)\n\t\t\tif (typeof scriptentity !== 'undefined') {\n\t\t\t\tscriptLoadDuration = scriptentity.duration\n\t\t\t}\n\t\t\tconst firstEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\t\t\tif (firstEntity && scriptentity && launchEntity) {\n\t\t\t\tif (\n\t\t\t\t\t!areInOrder(firstEntity.duration, launchEntity.duration) ||\n\t\t\t\t\t!areInOrder(scriptentity.duration, launchEntity.duration)\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tcodeDownloadDuration =\n\t\t\t\t\tlaunchEntity.duration - firstEntity.duration - scriptentity.duration\n\t\t\t\t// 资源下载时间暂时定为：首次启动时间-脚本加载时间-初次渲染时间\n\t\t\t}\n\t\t\tcallback({\n\t\t\t\tstartupDuration,\n\t\t\t\tscriptLoadDuration,\n\t\t\t\tcodeDownloadDuration,\n\t\t\t})\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\n","import { rewriteApp } from './index'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nexport function startAppCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.APP_UPDATE, function (appinfo) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessAppUpdate(appinfo),\n\t\t)\n\t})\n\n\treturn rewriteApp(configuration, lifeCycle)\n}\n\nfunction processAppUpdate(appinfo) {\n\tvar appEvent = {\n\t\tdate: appinfo.startTime,\n\t\ttype: RumEventType.APP,\n\t\tapp: {\n\t\t\tstartupDuration: msToNs(appinfo.startupDuration),\n\t\t\tscriptLoadDuration: msToNs(appinfo.scriptLoadDuration),\n\t\t\tcodeDownloadDuration: msToNs(appinfo.codeDownloadDuration),\n\t\t\tstartupType: appinfo.startupType,\n\t\t\ttimeSpent: msToNs(appinfo.duration),\n\t\t},\n\t}\n\treturn {\n\t\trawRumEvent: appEvent,\n\t\tstartTime: appinfo.startTime,\n\t}\n}\n","import { buildEnv } from './buildEnv'\nimport { LifeCycle } from '../core/lifeCycle'\nimport { commonInit } from '../core/configuration'\nimport { startErrorCollection } from '../rumEventsCollection/error/errorCollection'\nimport { startRumAssembly } from '../rumEventsCollection/assembly'\nimport { startParentContexts } from '../rumEventsCollection/parentContexts'\nimport { startRumBatch } from '../rumEventsCollection/transport/batch'\nimport { startViewCollection } from '../rumEventsCollection/page/viewCollection'\nimport { startRequestCollection } from '../rumEventsCollection/requestCollection'\nimport { startResourceCollection } from '../rumEventsCollection/resource/resourceCollection'\nimport { startAppCollection } from '../rumEventsCollection/app/appCollection'\nimport { startPagePerformanceObservable } from '../rumEventsCollection/performanceCollection'\n\nimport { sdk } from '../core/sdk'\nexport const startRum = function (userConfiguration) {\n\tconst configuration = commonInit(userConfiguration, buildEnv)\n\tconst lifeCycle = new LifeCycle()\n\tvar parentContexts = startParentContexts(lifeCycle)\n\tvar batch = startRumBatch(configuration, lifeCycle)\n\n\tstartRumAssembly(\n\t\tuserConfiguration.applicationId,\n\t\tconfiguration,\n\t\tlifeCycle,\n\t\tparentContexts,\n\t)\n\tstartAppCollection(lifeCycle, configuration)\n\tstartResourceCollection(lifeCycle, configuration)\n\tstartViewCollection(lifeCycle, configuration)\n\tstartErrorCollection(lifeCycle, configuration)\n\tstartRequestCollection(lifeCycle, configuration)\n\tstartPagePerformanceObservable(lifeCycle, configuration)\n}\n","import { isPercentage } from '../helper/utils'\nimport { startRum } from './rum'\nexport const makeRum = function (startRumImpl) {\n\tvar isAlreadyInitialized = false\n\tvar rumGlobal = {\n\t\tinit: function (userConfiguration) {\n\t\t\tif (typeof userConfiguration === 'undefined') {\n\t\t\t\tuserConfiguration = {}\n\t\t\t}\n\t\t\tif (!canInitRum(userConfiguration)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tstartRumImpl(userConfiguration)\n\n\t\t\tisAlreadyInitialized = true\n\t\t},\n\t}\n\treturn rumGlobal\n\tfunction canInitRum(userConfiguration) {\n\t\tif (isAlreadyInitialized) {\n\t\t\tconsole.error('DATAFLUX_RUM is already initialized.')\n\t\t\treturn false\n\t\t}\n\n\t\tif (!userConfiguration.applicationId) {\n\t\t\tconsole.error(\n\t\t\t\t'Application ID is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (!userConfiguration.datakitOrigin) {\n\t\t\tconsole.error(\n\t\t\t\t'datakitOrigin is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (\n\t\t\tuserConfiguration.sampleRate !== undefined &&\n\t\t\t!isPercentage(userConfiguration.sampleRate)\n\t\t) {\n\t\t\tconsole.error('Sample Rate should be a number between 0 and 100')\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n}\nexport const datafluxRum = makeRum(startRum)\n","import { LifeCycleEventType } from '../core/lifeCycle'\nimport { sdk } from '../core/sdk'\nexport function startPagePerformanceObservable(lifeCycle, configuration) {\n\tif (!!sdk.getPerformance) {\n\t\tconst performance = sdk.getPerformance()\n\t\tconst observer = performance.createObserver((entryList) => {\n\t\t\tlifeCycle.notify(\n\t\t\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\t\t\tentryList.getEntries(),\n\t\t\t)\n\t\t})\n\t\tobserver.observe({ entryTypes: ['render', 'script', 'navigation'] })\n\t}\n}\n"],"sourceRoot":""}
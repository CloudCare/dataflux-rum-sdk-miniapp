module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";t.r(r),t.d(r,"datafluxRum",(function(){return tr}));var n=Array.prototype,o=Object.prototype,s=(o=Object.prototype).hasOwnProperty,i=n.slice,a=o.toString,u=n.forEach,c=function(e,r,t){if(null===e)return!1;if(u&&e.forEach===u)e.forEach(r,t);else if(e.length===+e.length){for(var n=0,o=e.length;n<o;n++)if(n in e&&!1===r.call(t,e[n],n,e))return!1}else for(var i in e)if(s.call(e,i)&&!1===r.call(t,e[i],i,e))return!1},f=function(e){var r=[];return null===e||c(e,(function(e){r[r.length]=e})),r};function d(e){return"number"!=typeof e?e:+(1e6*e).toFixed(0)}var p=function(e){return"[object String]"===a.call(e)},l=function(e){return"[object Number]"===a.call(e)&&/[\d\.]+/.test(String(e))},v=function(e){return e?e.toArray?e.toArray():Array.isArray(e)?i.call(e):(r=e)&&s.call(r,"callee")?i.call(e):f(e):[];var r},m=function(){for(var e=v(arguments),r=1;r<e.length;r+=1)if(e[r-1]>e[r])return!1;return!0};function g(e){return e?(parseInt(e,10)^16*Math.random()>>parseInt(e,10)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,g)}var _=function(e){return i.call(arguments,1).forEach((function(r){for(var t in r)void 0!==r[t]&&(e[t]=r[t])})),e},h=function(e){return i.call(arguments,1).forEach((function(r){for(var t in r)void 0!==r[t]&&(y(r[t])&&y(e[t])?_(e[t],r[t]):e[t]=r[t])})),e},y=function(e){return null!==e&&"[object Object]"===a.call(e)},b=Date.now||function(){return(new Date).getTime()},w=function(e,r,t){var n,o,s,i,a=0;t||(t={});var u=function(){a=!1===t.leading?0:(new Date).getTime(),n=null,i=e.apply(o,s),n||(o=s=null)},c=function(){s=arguments;var c=(new Date).getTime();a||!1!==t.leading||(a=c);var f=r-(c-a);return o=this,f<=0||f>r?(n&&(clearTimeout(n),n=null),a=c,i=e.apply(o,s),n||(o=s=null)):n||!1===t.trailing||(n=setTimeout(u,f)),i};return c.cancel=function(){clearTimeout(n),a=0,n=null},c};function k(){}function S(e,r){for(var t=r.split(".");t.length;){var n=t.shift();if(!(n in e)||!s.call(e,n))return;e=e[n]}return e}function T(e){const r={};return Object.keys(e).forEach(t=>{var n;r[(n=t,n.replace(/[A-Z]/g,(e,r)=>`${0!==r?"_":""}${e.toLowerCase()}`).replace(/-/g,"_"))]=function e(r){if(Array.isArray(r))return r.map(r=>e(r));if("object"==typeof r&&null!==r)return T(r);return r}(e[t])}),r}function E(e){if(!p(e))return e;return String(e).replace(/[\s=,"]/g,(function(e){return"\\"+e}))}var x=function(e){var r=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,void 0!==e&&this._parse(e)};return r.prototype.setUrl=function(e){this._parse(e)},r.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},r.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var r=this._values.QueryString||"";for(var t in e)r=new RegExp(t+"[^&]+").test(r)?r.replace(new RegExp(t+"[^&]+"),t+"="+e[t]):"&"===r.slice(-1)?r+t+"="+e[t]:""===r?t+"="+e[t]:r+"&"+t+"="+e[t];this._values.QueryString=r},r.prototype.getParse=function(){return this._values},r.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},r.prototype._parse=function(e){this._initValues();var r=this._regex.exec(e);if(!r)throw"DPURLParser::_parse -> Invalid URL";for(var t in this._fields)void 0!==r[this._fields[t]]&&(this._values[t]=r[this._fields[t]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new r(e)};const O=function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t},R=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e},C={sdkVersion:"<<< SDK_VERSION >>>",sdkName:"Web SDK"};class P{constructor(){this.callbacks={}}notify(e,r){const t=this.callbacks[e];t&&t.forEach(e=>e(r))}subscribe(e,r){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(r),{unsubscribe:()=>{this.callbacks[e]=this.callbacks[e].filter(e=>r!==e)}}}}var I="PERFORMANCE_ENTRY_COLLECTED",D="APP_HIDE",L="APP_UPDATE",z="VIEW_CREATED",M="VIEW_UPDATED",j="REQUEST_STARTED",U="REQUEST_COMPLETED",B="RAW_RUM_EVENT_COLLECTED",N="RUM_EVENT_COLLECTED";const q="error",A="view",F="resource",V="app";var H="network",$="resource",W={sampleRate:100,flushTimeout:3e4,maxErrorsByMinute:3e3,maxBatchSize:50,maxMessageSize:262144,batchBytesLimit:16384,datakitUrl:"",requestErrorResponseLengthLimit:32768};function Q(e,r){return function(e,r){const t=x(e).getParse(),n=x(r).getParse();return t.Origin===n.Origin}(e,r.datakitUrl)}var K="agent",G="console",J="network",Y="source";function Z(e){var r=e.name||"Error: "+e.message;return e.stack.forEach((function(e){var t="?"===e.func?"<anonymous>":e.func,n=e.args&&e.args.length>0?"("+e.args.join(", ")+")":"",o=e.line?":"+e.line:"",s=e.line&&e.column?":"+e.column:"";r+="\n  at "+t+n+" @ "+e.url+o+s})),r}const X=function(){var e=null,r="";try{wx&&"object"==typeof wx&&"function"==typeof wx.request&&(e=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach((function(r){R(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},wx),r="wx",wx=e)}catch(e){console.warn("unsupport platform, Fail to start")}return console.log("------get SDK-------"),{sdk:e,tracker:r}}(),ee=X.sdk;X.tracker;function re(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var te,ne=function(){var e,r,t,n,o=[];function s(e,r,t){var n;for(var s in o)if(re(o,s))try{o[s](e,r,t)}catch(e){n=e}if(n)throw n}function i(e){const r="string"==typeof e?new Error(e):e;var t,n="",o="";if(t=oe(r),r&&r.message&&"[object String]"==={}.toString.call(r.message)){const e=r.message.split("\n");if(e.length>=3){const r=(o=e[2]).match(se);r&&(n=r[1],o=r[2])}}o&&(t.message=o),n&&(t.name=n),s(t,!0,r)}function a({reason:e,promise:r}){const t="string"==typeof e?new Error(e):e;var n,o="",i="";if(n=oe(t),t&&t.message&&"[object String]"==={}.toString.call(t.message)){const e=t.message.split("\n");if(e.length>=3){const r=(i=e[2]).match(se);r&&(o=r[1],i=r[2])}}i&&(n.message=i),o&&(n.name=o),s(n,!0,t)}function u(e){}return u.subscribe=function(u){!function(){if(e||!ee.onError)return;ee.onError(i),e=!0}(),function(){if(r||!ee.onUnhandledRejection)return;ee.onUnhandledRejection&&ee.onUnhandledRejection(a),r=!0}(),function(){if(t||!ee.onPageNotFound)return;ee.onPageNotFound(e=>{const r=e.path.split("?")[0];s({message:JSON.stringify(e),type:"pagenotfound",name:r+"页面无法找到"},!0,{})}),t=!0}(),function(){if(n||!ee.onMemoryWarning)return;ee.onMemoryWarning(({level:e=-1})=>{let r="没有获取到告警级别信息";switch(e){case 5:r="TRIM_MEMORY_RUNNING_MODERATE";break;case 10:r="TRIM_MEMORY_RUNNING_LOW";break;case 15:r="TRIM_MEMORY_RUNNING_CRITICAL";break;default:return}s({message:r,type:"memorywarning",name:"内存不足告警"},!0,{})}),n=!0}(),o.push(u)},u.unsubscribe=function(e){for(var r=o.length-1;r>=0;r-=1)o[r]===e&&o.splice(r,1)},u.traceKitWindowOnError=i,u}(),oe=function(){function e(e){if(e.stack){for(var r,t,n,o,s=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,i=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,a=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,u=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,c=/\((\S*)(?::(\d+))(?::(\d+))\)/,f=e.stack.split("\n"),d=[],p=0,l=f.length;p<l;p+=1){if(s.exec(f[p])){var v=(n=s.exec(f[p]))[2]&&0===n[2].indexOf("native");r=n[2]&&0===n[2].indexOf("eval"),t=c.exec(n[2]),r&&t&&(n[2]=t[1],n[3]=t[2],n[4]=t[3]),o={args:v?[n[2]]:[],column:n[4]?+n[4]:void 0,func:n[1]||"?",line:n[3]?+n[3]:void 0,url:v?void 0:n[2]}}else if(a.exec(f[p]))o={args:[],column:(n=a.exec(f[p]))[4]?+n[4]:void 0,func:n[1]||"?",line:+n[3],url:n[2]};else{if(!i.exec(f[p]))continue;r=(n=i.exec(f[p]))[3]&&n[3].indexOf(" > eval")>-1,t=u.exec(n[3]),r&&t?(n[3]=t[1],n[4]=t[2],n[5]=void 0):0!==p||n[5]||void 0===e.columnNumber||(d[0].column=e.columnNumber+1),o={args:n[2]?n[2].split(","):[],column:n[5]?+n[5]:void 0,func:n[1]||"?",line:n[4]?+n[4]:void 0,url:n[3]}}!o.func&&o.line&&(o.func="?"),d.push(o)}if(d.length)return{stack:d,message:ie(e),name:e.name}}}function r(e,r,t,n){var o={url:r,line:t?+t:void 0};if(o.url&&o.line){e.incompvare=!1;var s=e.stack;if(s.length>0&&s[0].url===o.url){if(s[0].line===o.line)return!1;if(!s[0].line&&s[0].func===o.func)return s[0].line=o.line,s[0].context=o.context,!1}return s.unshift(o),e.partial=!0,!0}return e.incompvare=!0,!1}function t(e,n){for(var o,s,i=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,a=[],u={},c=!1,f=t.caller;f&&!c;f=f.caller)f!==oe&&f!==ne&&(s={args:[],column:void 0,func:"?",line:void 0,url:void 0},o=i.exec(f.toString()),f.name?s.func=f.name:o&&(s.func=o[1]),void 0===s.func&&(s.func=o?o.input.substring(0,o.input.indexOf("{")):void 0),u[f+""]?c=!0:u[f+""]=!0,a.push(s));n&&a.splice(0,n);var d={stack:a,message:e.message,name:e.name};return r(d,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),d}function n(r,n){var o,s=void 0===n?0:+n;try{if(o=function(e){var r=e.stacktrace;if(r){for(var t,n=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,o=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,s=r.split("\n"),i=[],a=0;a<s.length;a+=2){var u;n.exec(s[a])?u={args:[],column:void 0,func:(t=n.exec(s[a]))[3],line:+t[1],url:t[2]}:o.exec(s[a])&&(u={args:(t=o.exec(s[a]))[5]?t[5].split(","):[],column:+t[2],func:t[3]||t[4],line:+t[1],url:t[6]}),u&&(!u.func&&u.line&&(u.func="?"),u.context=[s[a+1]],i.push(u))}if(i.length)return{stack:i,message:ie(e),name:e.name}}}(r))return o}catch(e){0}try{if(o=e(r))return o}catch(e){0}try{if(o=function(e){var r=e.message.split("\n");if(!(r.length<4)){var t,n=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,o=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,s=/^\s*Line (\d+) of function script\s*$/i,i=[],a=window&&window.document&&window.document.getElementsByTagName("script"),u=[];for(var c in a)re(a,c)&&!a[c].src&&u.push(a[c]);for(var f=2;f<r.length;f+=2){var d;if(n.exec(r[f]))d={args:[],column:void 0,func:(t=n.exec(r[f]))[3],line:+t[1],url:t[2]};else if(o.exec(r[f]))d={args:[],column:void 0,func:(t=o.exec(r[f]))[4],line:+t[1],url:t[3]};else if(s.exec(r[f])){t=s.exec(r[f]),d={url:window.location.href.replace(/#.*$/,""),args:[],column:void 0,func:"",line:+t[1]}}d&&(d.func||(d.func="?"),d.context=[r[f+1]],i.push(d))}if(i.length)return{stack:i,message:r[0],name:e.name}}}(r))return o}catch(e){0}try{if(o=t(r,s+1))return o}catch(e){0}return{message:ie(r),name:r.name,stack:[]}}return n.augmentStackTraceWithInitialElement=r,n.computeStackTraceFromStackProp=e,n.ofCaller=function(e){var r=1+(void 0===e?0:+e);try{throw new Error}catch(e){return oe(e,r+1)}},n}(),se=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function ie(e){const r=e&&e.message;return r?r.error&&"string"==typeof r.error.message?r.error.message:r:"No error message"}class ae{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}notify(e){this.observers.forEach((function(r){r(e)}))}}var ue,ce,fe=[],de=[];function pe(){return te||(ue=ee.request,ee.request=function(){var e={method:arguments[0].method||"GET",startTime:0,url:arguments[0].url,type:H,responseType:arguments[0].responseType||"text"};e.startTime=b();var r=arguments[0].success;arguments[0].success=function(){o(arguments[0]),r&&r.apply(_this,arguments)};var t=arguments[0].fail;arguments[0].fail=function(){o(arguments[0]),t&&t.apply(_this,arguments)};var n=!1,o=function(r){n||(n=!0,e.duration=b()-e.startTime,e.response=JSON.stringify(r.data),e.header=r.header||{},e.profile=r.profile,e.status=r.statusCode||r.status||0,de.forEach((function(r){r(e)})))};return fe.forEach((function(r){r(e)})),ue.apply(this,arguments)},te={beforeSend:function(e){fe.push(e)},onRequestComplete:function(e){de.push(e)}}),te}var le,ve,me,ge,_e=[],he=[];function ye(){return ce||(le=ee.downloadFile,ee.downloadFile=function(){var e={startTime:0,url:arguments[0].url,type:$,responseType:"file"};e.startTime=b();var r=arguments[0].success;arguments[0].success=function(){o(arguments[0]),r&&r.apply(_this,arguments)};var t=arguments[0].fail;arguments[0].fail=function(){o(arguments[0]),t&&t.apply(_this,arguments)};var n=!1,o=function(r){n||(n=!0,e.duration=b()-e.startTime,e.response=JSON.stringify({filePath:r.filePath,tempFilePath:r.tempFilePath}),e.header=r.header||{},e.profile=r.profile,e.status=r.statusCode||r.status||0,he.forEach((function(r){r(e)})))};return _e.forEach((function(r){r(e)})),le.apply(this,arguments)},ce={beforeSend:function(e){_e.push(e)},onRequestComplete:function(e){he.push(e)}}),ce}function be(e){return"string"==typeof e?e:e instanceof Error?Z(oe(e)):JSON.stringify(e,void 0,2)}function we(e){me=function(r,t,n){var o=function(e,r,t){return e&&(void 0!==e.message||r instanceof Error)?{message:e.message||"Empty message",stack:Z(e),type:e.name}:{message:t+""+JSON.stringify(r),stack:"No stack, consider using an instance of Error",type:e&&e.name}}(r,n,"Uncaught");e.notify({message:o.message,stack:o.stack,type:o.type,source:Y,startTime:b()})},ne.subscribe(me)}function ke(e){if(!ge){var r=new ae;!function(e,r){function t(t,n){Q(n.url,e)||!function(e){return 0===e.status&&"opaque"!==e.responseType}(n)&&!function(e){return e.status>=500}(n)||r.notify({message:Te(t)+"error"+n.method+" "+n.url,resource:{method:n.method,statusCode:n.status,url:n.url},type:J,source:J,stack:Se(n.response,e)||"Failed to load",startTime:n.startTime})}pe().onRequestComplete((function(e){return t(e.type,e)})),ye().onRequestComplete((function(e){return t(e.type,e)}))}(e,r),function(e){ve=console.error,console.error=function(){ve.apply(console,arguments);var r=v(arguments),t=[];r.concat(["console error:"]).forEach((function(e){t.push(be(e))})),e.notify({message:t.join(" "),source:G,startTime:b()})}}(r),we(r),ge=function(e,r){var t=0,n=new ae;return r.subscribe((function(r){t<e.maxErrorsByMinute?(t+=1,n.notify(r)):t===e.maxErrorsByMinute&&(t+=1,n.notify({message:"Reached max number of errors by minute: "+e.maxErrorsByMinute,source:K,startTime:b()}))})),setInterval((function(){t=0}),6e4),n}(e,r)}return ge}function Se(e,r){return e&&e.length>r.requestErrorResponseLengthLimit?e.substring(0,r.requestErrorResponseLengthLimit)+"...":e}function Te(e){return H===e?"XHR":$}function Ee(e,r){return function(e,r,t){t.subscribe((function(r){e.notify(B,function(e){return{rawRumEvent:{date:e.startTime,error:{message:e.message,resource:e.resource,source:e.source,stack:e.stack,type:e.type,starttime:e.startTime},type:q},startTime:e.startTime}}(r))}))}(e,0,ke(r))}var xe=new class{constructor(){this.sessionId=g(),this.getDeviceInfo(),this.getNetWork()}getDeviceInfo(){const e=ee.getSystemInfoSync();var r=e.system.split(" ");this.deviceInfo={screenSize:`${e.screenWidth}*${e.screenHeight} `,platform:e.platform,platformVersion:e.version,osVersion:r.length>1&&r[1],os:r.length>1&&r[0],brand:e.brand,model:e.model,frameworkVersion:e.SDKVersion,pixelRatio:e.pixelRatio}}getClientID(){var e=ee.getStorageSync("datafluxRum:client:id");return e||(e=g(),ee.setStorageSync("datafluxRum:client:id",e)),e}getNetWork(){ee.getNetworkType({success:e=>{this.deviceInfo.network=e.networkType?e.networkType:"unknown"}}),ee.onNetworkStatusChange(e=>{this.deviceInfo.network=e.networkType?e.networkType:"unknown"})}getSessionId(){return this.sessionId}};function Oe(e){return 0!==(r=e.sampleRate)&&100*Math.random()<=r;var r}function Re(e){var r,t=[];e.subscribe(z,(function(e){r&&t.unshift({context:o(),endTime:e.startTime,startTime:r.startTime}),r=e})),e.subscribe(M,(function(e){r.id===e.id&&(r=e)}));var n=setInterval((function(){!function(e,r){var t=b()-r;for(;e.length>0&&e[e.length-1].startTime<t;)e.pop()}(t,144e5)}),6e4);function o(){return{page:{id:r.id,referrer:t.length&&t[t.length-1].context.page.route,route:r.route}}}var s={findView:function(e){return function(e,r,t,n){if(void 0===n)return t?e():void 0;if(t&&n>=t.startTime)return e();var o=void 0;return r.forEach((function(e){return!(n>e.endTime)&&(n>=e.startTime?(o=e.context,!1):void 0)})),o}(o,t,r,e)},findViewV2:function(e){var r=s.findView(e);if(r)return{page:r.page}},stop:function(){clearInterval(n)}};return s}var Ce={rum_mini_app_startup:{type:V,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",app_startup_type:"app.startup_type"},fields:{app_script_load_duration:"app.script_load_duration",app_code_download_duration:"app.code_download_duration",app_startup_duration:"app.startup_duration"}},rum_mini_app_page_performance:{type:A,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",page_apdex_level:"page.apdex_level"},fields:{page_fmp:"page.fmp",page_fpt:"page.fpt",page_resource_load_time:"page.loading_time",page_onload2onshow:"page.onload2onshow",page_onshow2onready:"page.onshow2onready",page_staytime:"page.stayTime",page_js_error_count:"page.error.count"}},rum_mini_app_resource_performance:{type:F,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",version:"_dd.version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",resource_status_group:"resource.status_group",resource_url_host:"resource.url_host",resource_type:"resource.type",resource_status:"resource.status",resource_method:"resource.method",response_connection:"resource.response_connection",response_server:"resource.response_server",response_content_type:"resource.response_content_type",response_content_encoding:"resource.response_content_encoding"},fields:{resource_size:"resource.size",resource_load:"resource.load",resource_dns:"resource.dns",resource_tcp:"resource.tcp",resource_ssl:"resource.ssl",resource_ttfb:"resource.ttfb",resource_trans:"resource.trans",resource_firstbyte:"resource.firstbyte"}},page:{type:A,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",os_version:"device.os_version",origin_id:"user.origin_id",userid:"user.user_id",page_id:"page.id",page_url:"page.route",page_referer:"page.referer",page_apdex_level:"page.apdex_level"},fields:{page_fmp:"page.fmp",page_fpt:"page.fpt",page_resource_load_time:"page.loading_time",page_onload2onshow:"page.onload2onshow",page_onshow2onready:"page.onshow2onready",page_staytime:"page.stayTime",page_js_error_count:"page.error.count"}},resource:{type:F,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",os_version:"device.os_version",origin_id:"user.origin_id",userid:"user.user_id",page_id:"page.id",page_url:"page.route",page_referer:"page.referer",resource_url:"resource.url",resource_url_host:"resource.url_host",resource_url_path:"resource.url_path",resource_type:"resource.type",resource_status:"resource.status",resource_status_group:"resource.status_group",resource_method:"resource.method",response_connection:"resource.response_connection",response_server:"resource.response_server",response_content_type:"resource.response_content_type",response_content_encoding:"resource.response_content_encoding"},fields:{resource_size:"resouce.size",resource_load:"resource.load",resource_dns:"resource.dns",resource_tcp:"resource.tcp",resource_ssl:"resource.ssl",resource_ttfb:"resource.ttfb",resource_trans:"resource.trans",resource_firstbyte:"resource.firstbyte",request_header:["string","request.header"],response_header:["string","response.header"],page_url:["string","page.route"],page_referer:["string","page.referer"]}},js_error:{type:q,tags:{app_id:"application.id",env:"_dd.env",app_version:"_dd.version",sdk_name:"_dd.sdk_name",sdk_version:"_dd.sdk_version",is_signin:"user.is_signin",os:"device.os",device:"device.model",screen_size:"device.screen_size",network_type:"device.network",platform:"device.platform",platform_version:"device.platform_version",app_framework_version:"device.framework_version",os_version:"device.os_version",origin_id:"user.origin_id",userid:"user.user_id",page_id:"page.id",page_url:"page.route",page_referer:"page.referer",error_type:"error.type"},fields:{error_starttime:"error.starttime",error_message:["string","error.message"],error_stack:["string","error.stack"]}}},Pe=/[^\u0000-\u007F]/;var Ie=function(e,r){this.endpointUrl=e,this.bytesLimit=r};Ie.prototype={send:function(e){var r=function(e){return e?e+(-1===e.indexOf("?")?"?":"&")+"precision=ms":e}(this.endpointUrl);ee.request({method:"POST",header:{"content-type":"text/plain;charset=UTF-8"},url:r,data:e})}};var De=Ie;function Le(e,r,t,n,o,s){this.request=e,this.maxSize=r,this.bytesLimit=t,this.maxMessageSize=n,this.flushTimeout=o,this.lifeCycle=s,this.flushOnVisibilityHidden(),this.flushPeriodically()}Le.prototype={pushOnlyBuffer:[],upsertBuffer:{},bufferBytesSize:0,bufferMessageCount:0,add:function(e){this.addOrUpdate(e)},upsert:function(e,r){this.addOrUpdate(e,r)},flush:function(){if(0!==this.bufferMessageCount){var e=this.pushOnlyBuffer.concat(f(this.upsertBuffer));this.request.send(e.join("\n"),this.bufferBytesSize),this.pushOnlyBuffer=[],this.upsertBuffer={},this.bufferBytesSize=0,this.bufferMessageCount=0}},processSendData:function(e){if(!e||!e.type)return"";var r=[];return c(Ce,(function(t,n){if(t.type===e.type){var o="";o+=n+",";var s=[];c(t.tags,(function(r,t){var n=S(e,r);(n||l(n))&&s.push(E(t)+"="+E(n))})),e.tags.length&&c(e.tags,(function(e,r){(e||l(e))&&s.push(E(r)+"="+E(e))}));var i=[];c(t.fields,(function(r,t){if(Array.isArray(r)&&2===r.length){var n=r[0],o=r[1];((s=S(e,o))||l(s))&&(s="string"===n?'"'+s.replace(/[\\]*"/g,'"').replace(/"/g,'\\"')+'"':E(s),i.push(E(t)+"="+s))}else if(p(r)){var s;((s=S(e,r))||l(s))&&(s=E(s),i.push(E(t)+"="+s))}})),s.length&&(o+=s.join(",")),i.length&&(o+=" ",o+=i.join(",")),o=o+" "+e.date,i.length&&r.push(o)}})),r.length?r.join("\n"):""},sizeInBytes:function(e){return Pe.test(e)?new Blob([e]).size:e.length},addOrUpdate:function(e,r){var t=this.process(e);t.processedMessage&&""!==t.processedMessage&&(t.messageBytesSize>=this.maxMessageSize?console.warn("Discarded a message whose size was bigger than the maximum allowed size"+this.maxMessageSize+"KB."):(this.hasMessageFor(r)&&this.remove(r),this.willReachedBytesLimitWith(t.messageBytesSize)&&this.flush(),this.push(t.processedMessage,t.messageBytesSize,r),this.isFull()&&this.flush()))},process:function(e){var r=this.processSendData(e);return{processedMessage:r,messageBytesSize:this.sizeInBytes(r)}},push:function(e,r,t){console.log(e,"processedMessage"),this.bufferMessageCount>0&&(this.bufferBytesSize+=1),void 0!==t?this.upsertBuffer[t]=e:this.pushOnlyBuffer.push(e),this.bufferBytesSize+=r,this.bufferMessageCount+=1},remove:function(e){var r=this.upsertBuffer[e];delete this.upsertBuffer[e];var t=this.sizeInBytes(r);this.bufferBytesSize-=t,this.bufferMessageCount-=1,this.bufferMessageCount>0&&(this.bufferBytesSize-=1)},hasMessageFor:function(e){return void 0!==e&&void 0!==this.upsertBuffer[e]},willReachedBytesLimitWith:function(e){return this.bufferBytesSize+e+1>=this.bytesLimit},isFull:function(){return this.bufferMessageCount===this.maxSize||this.bufferBytesSize>=this.bytesLimit},flushPeriodically:function(){var e=this;setTimeout((function(){e.flush(),e.flushPeriodically()}),e.flushTimeout)},flushOnVisibilityHidden:function(){var e=this;this.lifeCycle.subscribe(D,(function(){e.flush()}))}};var ze=Le;function Me(e,r){var t=function(e,r){var t=function(r,t){return new ze(new De(r,e.batchBytesLimit),e.maxBatchSize,e.batchBytesLimit,e.maxMessageSize,e.flushTimeout,t)}(e.datakitUrl,r);var n=!1;return{add:function(e){n||t.add(e)},stop:function(){n=!0},upsert:function(e,r){n||t.upsert(e,r)}}}(e,r);return r.subscribe(N,(function(e){var r=e.rumEvent,n=e.serverRumEvent;r.type===A?t.upsert(n,r.page.id):t.add(n)})),{stop:function(){t.stop()}}}function je(e,r){const t=Page;Page=function(e){var n,o=b();return["onUnload","onShow","onHide","onReady","onLoad"].forEach(t=>{const s=e[t];e[t]=function(e){if(("onShow"===t||"onLoad"===t)&&void 0===n){const e=function(){const e=getCurrentPages();if(e.length)return e[e.length-1];return{}}();n=function(e,r,t){void 0===t&&(t=b());var n,o,s,i,a,u,c,f=g(),d={errorCount:0,resourceCount:0},p=0;e.notify(z,{id:f,startTime:t,route:r});var l=w(h,3e3,{leading:!1}),v=l.cancel,m=function(e,r){void 0===r&&(r=k);var t={errorCount:0,resourceCount:0},n=e.subscribe(B,(function(e){switch(e.rawRumEvent.type){case q:t.errorCount+=1,r(t);break;case F:t.resourceCount+=1,r(t)}}));return{stop:function(){n.unsubscribe()},eventCounts:t}}(e,(function(e){d=e,l()})).stop,_=function(e,r){return{stop:e.subscribe(I,(function(e){const t=e.find(e=>"render"===e.entryType&&"firstRender"===e.name);void 0!==t&&r(t.duration)})).unsubscribe}}(e,(function(e){u=e,l()})).stop;function h(){p+=1,e.notify(M,{documentVersion:p,eventCounts:d,id:f,loadingTime:n,stayTime:a,onload2onshowTime:s,onshow2onready:i,fmp:c,fpt:u,startTime:t,route:r,duration:b()-t})}return{scheduleUpdate:l,setLoadEventEnd:function(e){console.log(e,"type"),"onLoad"===e?n=b():"onShow"===e?(o=b(),void 0===s&&void 0!==n&&(s=o-n)):"onReady"===e?(void 0===i&&void 0!==o&&(i=b()-o),void 0===c&&(c=b()-t)):"onHide"!==e&&"onUnload"!==e||void 0!==o&&(a=b()-o),l()},triggerUpdate:function(){v(),h()},end:function(){m(),_(),v()}}}(r,e&&e.route,o)}return n&&n.setLoadEventEnd(t),"onUnload"!==t&&"onHide"!==t&&"onShow"!==t||!n||(n.triggerUpdate(),"onUnload"===t&&n.end()),s&&s.call(this,e)}}),t(e)}}function Ue(e,r){return e.subscribe(M,(function(r){e.notify(B,function(e){var r;e.fmp&&(r=(r=parseInt(Number(e.fmp)/1e3))>9?9:r);return{rawRumEvent:{_dd:{documentVersion:e.documentVersion},date:e.startTime,type:A,page:{error:{count:e.eventCounts.errorCount},loadingTime:d(e.loadingTime),stayTime:d(e.stayTime),onload2onshow:d(e.onload2onshowTime),onshow2onready:d(e.onshow2onready),fpt:d(e.fpt),fmp:d(e.fmp),apdexLevel:r,timeSpent:d(e.duration)}},startTime:e.startTime}}(r))})),je(0,e)}function Be(){for(var e=v(arguments),r=1;r<e.length;r+=1)if(e[r-1]>e[r])return!1;return!0}function Ne(e){if(e.startTime<e.responseEnd)return d(e.responseEnd-e.startTime)}function qe(e){var r=function(e){if(!Be(e.startTime,e.fetchStart,e.domainLookupStart,e.domainLookupEnd,e.connectStart,e.connectEnd,e.requestStart,e.responseStart,e.responseEnd))return;if(!Ae(e))return e;var r=e.redirectStart,t=e.redirectEnd;r<e.startTime&&(r=e.startTime);t<e.startTime&&(t=e.fetchStart);if(!Be(e.startTime,r,t,e.fetchStart))return;return _({},e,{redirectEnd:t,redirectStart:r})}(e);if(r){var t=r.startTime,n=r.fetchStart,o=r.redirectStart,s=r.redirectEnd,i=r.domainLookupStart,a=r.domainLookupEnd,u=r.connectStart,c=r.SSLconnectionStart,f=r.SSLconnectionEnd,d=r.connectEnd,p=r.requestStart,l=r.responseStart,v=r.responseEnd,m={firstbyte:Fe(t,i,l),trans:Fe(t,l,v),ttfb:Fe(t,p,l)};return d!==n&&(m.tcp=Fe(t,u,d),Be(u,secureConnectionStart,f)&&(m.ssl=Fe(t,c,f))),a!==n&&(m.dns=Fe(t,i,a)),Ae(e)&&(m.redirect=Fe(t,o,s)),m}}function Ae(e){return e.fetchStart!==e.startTime}function Fe(e,r,t){return d(t-r)}function Ve(e){if(e.startTime<e.responseStart)return e.receivedBytedCount}function He(e,r){return r&&!Q(r,e)}var $e=1;function We(e,r){!function(e,r){var t=pe();t.beforeSend((function(t){He(r,t.url)&&(t.requestIndex=Ge(),e.notify(j,{requestIndex:t.requestIndex}))})),t.onRequestComplete((function(t){if(He(r,t.url)){var n=Qe(t.header||{});e.notify(U,{duration:t.duration,method:t.method,requestIndex:t.requestIndex,performance:t.profile,response:t.response,responseConnection:n.connection,responseServer:n.server,responseHeader:Ke(n),responseContentType:n["content-type"],responseContentEncoding:n["content-encoding"],startTime:t.startTime,status:t.status,type:t.type,url:t.url})}}))}(e,r),function(e,r){var t=ye();t.beforeSend((function(t){He(r,t.url)&&(t.requestIndex=Ge(),e.notify(j,{requestIndex:t.requestIndex}))})),t.onRequestComplete((function(t){if(He(r,t.url)){var n=Qe(t.header||{});e.notify(U,{duration:t.duration,requestIndex:t.requestIndex,performance:t.profile,response:t.response,responseConnection:n.connection,responseServer:n.server,responseHeader:Ke(n),responseContentType:n["content-type"],responseContentEncoding:n["content-encoding"],startTime:t.startTime,status:t.status,type:t.type,url:t.url})}}))}(e,r)}function Qe(e){if(!y(e))return e;var r={};return Object.keys(e).forEach((function(t){r[t.toLowerCase()]=e[t]})),r}function Ke(e){if(!y(e))return e;var r="";return Object.keys(e).forEach((function(t){r+=t+":"+e[t]+";"})),r}function Ge(){var e=$e;return $e+=1,e}function Je(e,r){e.subscribe(U,(function(r){e.notify(B,function(e){var r=e.type,t=e.performance,n=t?function(e){return{resource:h({},{load:Ne(e),size:Ve(e)},qe(e))}}(t):void 0,o=x(e.url).getParse(),s=e.startTime,i=h({date:s,resource:{type:r,load:d(e.duration),method:e.method,status:e.status,statusGroup:Ye(e.status),url:e.url,urlHost:o.Host,urlPath:o.Path,responseHeader:e.responseHeader,responseConnection:e.responseConnection,responseServer:e.responseServer,responseContentType:e.responseContentType,responseContentEncoding:e.responseContentEncoding},type:F},n);return{startTime:s,rawRumEvent:i}}(r))}))}function Ye(e){return e?String(e).substr(0,1)+String(e).substr(1).replace(/\d*/g,"x"):e}const Ze="cold",Xe="hot";function er(e,r){const t=App;var n,o={isStartUp:!1};App=function(e){return n=b(),["onLaunch","onShow","onHide"].forEach(t=>{const n=e[t];e[t]=function(e){return console.log(t,"methodName app"),"onLaunch"===t?(o.isStartUp=!0,o.isHide=!1,o.startupType=Ze):"onShow"===t?o.isStartUp&&o.isHide&&(o.startupType=Xe,s()):"onHide"===t&&(r.notify(D),o.isHide=!0),n&&n.call(this,e)}}),t(e)},function(e,r){e.subscribe(I,(function(e){var t,n,o;console.log(e,"entitys");const s=e.find(e=>"navigation"===e.entryType&&"appLaunch"===e.navigationType);void 0!==s&&(t=s.duration);const i=e.find(e=>"script"===e.entryType&&"evaluateScript"===e.name);void 0!==i&&(n=i.duration);const a=e.find(e=>"render"===e.entryType&&"firstRender"===e.name);if(a&&i&&s){if(!m(a.duration,s.duration)||!m(i.duration,s.duration))return;o=s.duration-a.duration-i.duration}r({startupDuration:t,scriptLoadDuration:n,codeDownloadDuration:o})})).unsubscribe}(r,(function(e){o={...o,...e},s()}));w(s,3e3,{leading:!1});function s(){r.notify(L,{startupDuration:o.startupDuration,scriptLoadDuration:o.scriptLoadDuration,codeDownloadDuration:o.codeDownloadDuration,startupType:o.startupType,startTime:n,duration:b()-n})}}function rr(e,r){return e.subscribe(L,(function(r){e.notify(B,function(e){return{rawRumEvent:{date:e.startTime,type:V,app:{startupDuration:d(e.startupDuration),scriptLoadDuration:d(e.scriptLoadDuration),codeDownloadDuration:d(e.codeDownloadDuration),startupType:e.startupType,timeSpent:d(e.duration)}},startTime:e.startTime}}(r))})),er(0,e)}const tr=(nr=function(e){const r=function(e,r){var t,n={applicationId:e.applicationId,env:e.env||"",version:e.version||"",sdkVersion:r.sdkVersion,sdkName:r.sdkName,datakitUrl:(t=e.datakitUrl||e.datakitOrigin,t.lastIndexOf("/")===t.length-1?t+"v1/write/rum":t+"/v1/write/rum"),tags:e.tags||[]};return h(W,n)}(e,C),t=new P;var n=Re(t);Me(r,t),function(e,r,t,n){t.subscribe(B,(function(o){var s=o.startTime,i=o.rawRumEvent,a=n.findViewV2(s),u={device:xe.deviceInfo};if(Oe(r)&&(a||"app"===i.type)){var c={_dd:{sdkName:r.sdkName,sdkVersion:r.sdkVersion,env:r.env,version:r.version},tags:r.tags,application:{id:e},device:{},date:(new Date).getTime(),user:{originId:xe.getSessionId(),user_id:r.user_id||xe.getClientID(),is_signin:r.user_id?"T":"F"}},f=h(c,u,a,i),d=T(f);t.notify(N,{rumEvent:f,serverRumEvent:d})}}))}(e.applicationId,r,t,n),rr(t),Je(t),Ue(t),Ee(t,r),We(t,r),function(e,r){ee.getPerformance&&ee.getPerformance().createObserver(r=>{e.notify(I,r.getEntries())}).observe({entryTypes:["render","script","navigation"]})}(t)},or=!1,{init:function(e){void 0===e&&(e={}),function(e){return or?(console.error("DATAFLUX_RUM is already initialized."),!1):e.applicationId?e.datakitOrigin?!!(void 0===e.sampleRate||(r=e.sampleRate,l(r)&&r>=0&&r<=100))||(console.error("Sample Rate should be a number between 0 and 100"),!1):(console.error("datakitOrigin is not configured, no RUM data will be collected."),!1):(console.error("Application ID is not configured, no RUM data will be collected."),!1);var r}(e)&&(nr(e),or=!0)}});var nr,or}]);
//# sourceMappingURL=dataflux-rum-miniapp.js.map